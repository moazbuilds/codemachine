
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.codemachine.co/dev/case-studies/sustaina/">
      
      
        <link rel="prev" href="../../specification-schema/">
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Case Study: Sustaina ESG Compliance Platform - CodeMachine CLI Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="black">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#case-study-sustaina-esg-compliance-platform" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CodeMachine CLI Documentation" class="md-header__button md-logo" aria-label="CodeMachine CLI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CodeMachine CLI Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Case Study: Sustaina ESG Compliance Platform
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="black"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="white"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/moazbuilds/CodeMachine-CLI" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    moazbuilds/CodeMachine-CLI
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../architecture/" class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../cli-reference/" class="md-tabs__link">
        
  
  
    
  
  CLI Reference

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../customizing-workflows/" class="md-tabs__link">
        
  
  
    
  
  Customizing Workflows

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../specification-schema/" class="md-tabs__link">
        
  
  
    
  
  Specification schema

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  Case studies

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CodeMachine CLI Documentation" class="md-nav__button md-logo" aria-label="CodeMachine CLI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CodeMachine CLI Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/moazbuilds/CodeMachine-CLI" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    moazbuilds/CodeMachine-CLI
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../customizing-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Customizing Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../specification-schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Specification schema
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Case studies
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Case studies
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Case Study: Sustaina ESG Compliance Platform
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Case Study: Sustaina ESG Compliance Platform
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ai-orchestrated-development-of-enterprise-grade-sustainability-compliance-system-via-codemachine" class="md-nav__link">
    <span class="md-ellipsis">
      
        AI-Orchestrated Development of Enterprise-Grade Sustainability Compliance System via CodeMachine
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Executive Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-project-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Project Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Project Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-business-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Business Context
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-project-scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 Project Scope
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-technical-challenge-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Technical Challenge &amp; Requirements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Technical Challenge &amp; Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-functional-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Functional Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-non-functional-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Non-Functional Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-technical-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Technical Constraints
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-codemachine-orchestration-platform" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. CodeMachine Orchestration Platform
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. CodeMachine Orchestration Platform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-platform-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Platform Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-core-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Core Components
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-orchestration-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Orchestration Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-orchestration-agents" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4 Orchestration Agents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-context-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.5 Context Injection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-architecture-technology-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Architecture &amp; Technology Stack
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Architecture &amp; Technology Stack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-architectural-style" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Architectural Style
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-technology-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Technology Stack
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 Technology Stack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frontend-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backend Services
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-event-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message &amp; Event Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure &amp; Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-observability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring &amp; Observability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security &amp; Authentication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-data-model-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 Data Model Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-api-design-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4 API Design Principles
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-implementation-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Implementation Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Implementation Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-iteration-based-delivery" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Iteration-Based Delivery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-verification-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Verification Strategy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-complete-project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Complete Project Structure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-key-implementation-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Key Implementation Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Key Implementation Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-multi-tenancy-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 Multi-Tenancy Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-event-driven-workflow-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Event-Driven Workflow Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-ai-extraction-pattern-with-confidence-scoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3 AI Extraction Pattern with Confidence Scoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-carbon-calculation-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.4 Carbon Calculation Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-infrastructure-as-code-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5 Infrastructure as Code Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-results-deliverables" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Results &amp; Deliverables
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Results &amp; Deliverables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-completed-deliverables" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 Completed Deliverables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-visual-deliverables" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Visual Deliverables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-code-quality-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.3 Code Quality Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-technical-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Technical Metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Technical Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-development-velocity-automation-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Development Velocity &amp; Automation Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-infrastructure-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Infrastructure Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-performance-benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3 Performance Benchmarks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94-scalability-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.4 Scalability Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ai-orchestrated-development-of-enterprise-grade-sustainability-compliance-system-via-codemachine" class="md-nav__link">
    <span class="md-ellipsis">
      
        AI-Orchestrated Development of Enterprise-Grade Sustainability Compliance System via CodeMachine
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Executive Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-project-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Project Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Project Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-business-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Business Context
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-project-scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 Project Scope
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-technical-challenge-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Technical Challenge &amp; Requirements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Technical Challenge &amp; Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-functional-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Functional Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-non-functional-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Non-Functional Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-technical-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Technical Constraints
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-codemachine-orchestration-platform" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. CodeMachine Orchestration Platform
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. CodeMachine Orchestration Platform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-platform-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Platform Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-core-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Core Components
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-orchestration-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Orchestration Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-orchestration-agents" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4 Orchestration Agents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-context-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.5 Context Injection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-architecture-technology-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Architecture &amp; Technology Stack
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Architecture &amp; Technology Stack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-architectural-style" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Architectural Style
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-technology-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Technology Stack
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 Technology Stack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frontend-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frontend Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backend-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backend Services
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-event-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Message &amp; Event Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure &amp; Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-observability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring &amp; Observability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security &amp; Authentication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-data-model-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 Data Model Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-api-design-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4 API Design Principles
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-implementation-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Implementation Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Implementation Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-iteration-based-delivery" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Iteration-Based Delivery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-verification-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Verification Strategy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-complete-project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Complete Project Structure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-key-implementation-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Key Implementation Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Key Implementation Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-multi-tenancy-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 Multi-Tenancy Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-event-driven-workflow-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Event-Driven Workflow Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-ai-extraction-pattern-with-confidence-scoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3 AI Extraction Pattern with Confidence Scoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-carbon-calculation-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.4 Carbon Calculation Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-infrastructure-as-code-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5 Infrastructure as Code Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-results-deliverables" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Results &amp; Deliverables
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Results &amp; Deliverables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-completed-deliverables" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 Completed Deliverables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-visual-deliverables" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Visual Deliverables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-code-quality-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.3 Code Quality Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-technical-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Technical Metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Technical Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-development-velocity-automation-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Development Velocity &amp; Automation Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-infrastructure-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Infrastructure Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-performance-benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3 Performance Benchmarks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94-scalability-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.4 Scalability Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="case-study-sustaina-esg-compliance-platform">Case Study: Sustaina ESG Compliance Platform</h1>
<h2 id="ai-orchestrated-development-of-enterprise-grade-sustainability-compliance-system-via-codemachine">AI-Orchestrated Development of Enterprise-Grade Sustainability Compliance System via CodeMachine</h2>
<p><strong>Document Version:</strong> 1.0
<strong>Publication Date:</strong> October 13, 2025
<strong>Project Duration:</strong> 10 weeks
<strong>Technology Stack:</strong> React, Python/FastAPI, Node.js/NestJS, PostgreSQL, MongoDB, Redis, AWS, Kubernetes
<strong>Generated by:</strong> CodeMachine AI Orchestration Platform</p>
<hr />
<h2 id="executive-summary">Executive Summary</h2>
<p>Sustaina is an AI-enabled Environmental, Social, and Governance (ESG) compliance platform designed to democratize sustainability reporting for Small and Medium Enterprises (SMEs) in Egypt and the MENA region. The platform transforms complex international regulations—including the EU's Carbon Border Adjustment Mechanism (CBAM), European Sustainability Reporting Standards (ESRS), ISO 14064, and GHG Protocol—into clear, actionable compliance pathways.</p>
<p>This case study documents how <strong>CodeMachine</strong>, a CLI-native AI orchestration platform, transformed a 187-page specification into a production-ready, enterprise-grade system comprising:</p>
<ul>
<li><strong>7 microservices</strong> (Python/FastAPI, Node.js/NestJS)</li>
<li><strong>Multi-database architecture</strong> (PostgreSQL, MongoDB, Redis, Elasticsearch)</li>
<li><strong>Event-driven workflows</strong> (Amazon SQS/SNS)</li>
<li><strong>Cloud-native infrastructure</strong> (AWS EKS, RDS, ElastiCache, S3)</li>
<li><strong>Complete CI/CD pipeline</strong> (GitHub Actions, ArgoCD, Terraform)</li>
<li><strong>Comprehensive monitoring</strong> (Prometheus, Grafana, ELK Stack)</li>
</ul>
<p><strong>Key Achievement:</strong> CodeMachine coordinated specialized AI agents across a multi-phase orchestration workflow to deliver 482 production-ready files (60,008 lines of code), complete infrastructure-as-code, and automated deployment pipelines—all generated from specification documents through intelligent agent orchestration.</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#1-project-overview">Project Overview</a></li>
<li><a href="#2-technical-challenge--requirements">Technical Challenge &amp; Requirements</a></li>
<li><a href="#3-codemachine-orchestration-platform">CodeMachine Orchestration Platform</a></li>
<li><a href="#4-architecture--technology-stack">Architecture &amp; Technology Stack</a></li>
<li><a href="#5-implementation-strategy">Implementation Strategy</a></li>
<li><a href="#6-complete-project-structure">Complete Project Structure</a></li>
<li><a href="#7-key-implementation-patterns">Key Implementation Patterns</a></li>
<li><a href="#8-results--deliverables">Results &amp; Deliverables</a></li>
<li><a href="#9-technical-metrics">Technical Metrics</a></li>
</ol>
<hr />
<h2 id="1-project-overview">1. Project Overview</h2>
<h3 id="11-business-context">1.1 Business Context</h3>
<p>SMEs in the MENA region face mounting pressure to demonstrate ESG compliance to access European markets and international financing. The EU's CBAM regulation, effective 2026, requires exporters to report embedded carbon emissions in products. ESRS mandates detailed sustainability disclosures for companies operating in EU markets. For resource-constrained SMEs, navigating these complex, multi-jurisdictional frameworks represents a significant barrier to growth.</p>
<p><strong>Sustaina's Mission:</strong> Provide an intelligent compliance assistant that:
- <strong>Automates regulatory intelligence</strong>: Maps jurisdiction-specific requirements based on industry, location, and target markets
- <strong>Simplifies carbon accounting</strong>: Calculates product-level Scope 1-3 emissions using verified emission factors
- <strong>Ensures audit readiness</strong>: AI-powered document verification against regulatory requirements
- <strong>Enables market access</strong>: Generates CBAM-compliant reports and ESG disclosures</p>
<h3 id="12-project-scope">1.2 Project Scope</h3>
<p><strong>Phase 1 (Current):</strong> Carbon Accounting &amp; CBAM Compliance
- Jurisdiction-aware compliance mapping (EU, UK, KSA, Egypt)
- Product-level embedded emissions calculation
- AI-powered document processing (invoices, EPDs, energy bills)
- Supply chain emission mapping
- CBAM report generation
- Compliance risk dashboards</p>
<p><strong>Phase 2 (Planned):</strong> Full ESG Reporting
- Materiality-based disclosure filtering (74 ESRS topics → 8-12 material issues)
- Social metrics tracking (labor, diversity, human rights)
- Governance metrics (ethics, data protection, board composition)
- Multi-framework report generation (ESRS, GRI, IFC Performance Standards)</p>
<p><strong>Out of Scope:</strong>
- Carbon credit trading mechanisms
- Blockchain-based supply chain traceability (future consideration)
- Physical product verification or IoT integration
- Direct regulatory submission (system generates compliant reports for manual submission)</p>
<hr />
<h2 id="2-technical-challenge-requirements">2. Technical Challenge &amp; Requirements</h2>
<h3 id="21-functional-requirements">2.1 Functional Requirements</h3>
<table>
<thead>
<tr>
<th>Requirement ID</th>
<th>Description</th>
<th>Technical Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>FR-COMP-001</strong></td>
<td>Multi-jurisdiction framework mapping (EU CBAM, ESRS, ISO 14064, KSA PDPL, Egypt regulations)</td>
<td>Requires flexible regulatory rule engine with versioned framework definitions in MongoDB</td>
</tr>
<tr>
<td><strong>FR-CARBON-001</strong></td>
<td>Product-level Scope 1-3 emissions calculation using verified emission factors</td>
<td>Demands integration with licensed databases (Ecoinvent, DEFRA, EPA), complex aggregation logic</td>
</tr>
<tr>
<td><strong>FR-AI-001</strong></td>
<td>Multi-format document ingestion (PDF, images, Excel) with LLM-based field extraction</td>
<td>Requires OCR pipeline (PyTesseract) + GPT-4 API integration with prompt engineering</td>
</tr>
<tr>
<td><strong>FR-CBAM-002</strong></td>
<td>Export-ready CBAM reports (kg CO₂e per unit) for EU importers</td>
<td>Necessitates PDF generation with standardized templates, S3 storage, audit trails</td>
</tr>
<tr>
<td><strong>FR-RISK-001</strong></td>
<td>Traffic-light compliance risk scoring (Green/Yellow/Orange/Red)</td>
<td>Real-time risk calculation engine with evidence gap detection and remediation logic</td>
</tr>
<tr>
<td><strong>FR-SC-001</strong></td>
<td>Supply chain emission mapping with substitution logic for missing data</td>
<td>Graph-based supplier relationships, intelligent default emission factor selection</td>
</tr>
</tbody>
</table>
<h3 id="22-non-functional-requirements">2.2 Non-Functional Requirements</h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Requirement</th>
<th>Architectural Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Performance</strong></td>
<td>&lt;60s processing for compliance calculations (≤100 suppliers)</td>
<td>Asynchronous event-driven workflows (SQS), Redis caching, optimized database queries</td>
</tr>
<tr>
<td><strong>Accuracy</strong></td>
<td>&gt;90% AI extraction accuracy (structured docs), &gt;80% (semi-structured)</td>
<td>Multi-stage validation pipeline, confidence scoring, human-in-the-loop for low-confidence extractions</td>
</tr>
<tr>
<td><strong>Reliability</strong></td>
<td>99.5% uptime (≈3.6 hours downtime/month)</td>
<td>Multi-AZ deployment, health checks, circuit breakers, automated failover (RDS Multi-AZ)</td>
</tr>
<tr>
<td><strong>Security</strong></td>
<td>GDPR and KSA PDPL compliance</td>
<td>AES-256 encryption at rest, TLS 1.3 in transit, RBAC, audit logging, regional data residency</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>1,000+ concurrent users</td>
<td>Horizontal pod auto-scaling (Kubernetes HPA), stateless services, distributed caching</td>
</tr>
<tr>
<td><strong>Extensibility</strong></td>
<td>Easy integration of new ESG frameworks</td>
<td>Rule engine with JSON-based framework definitions, versioned APIs, adapter pattern</td>
</tr>
</tbody>
</table>
<h3 id="23-technical-constraints">2.3 Technical Constraints</h3>
<ol>
<li><strong>Multi-Tenancy:</strong> Strict data isolation between SME tenants (row-level security with <code>company_id</code> partition key)</li>
<li><strong>Regional Compliance:</strong> Data residency requirements necessitate multi-region deployment (EU-Central-1 for GDPR, ME-South-1 for KSA PDPL)</li>
<li><strong>Document Variability:</strong> Must handle diverse document formats with varying quality (handwritten invoices, scanned PDFs, digital exports)</li>
<li><strong>Emission Data Licensing:</strong> Dependency on third-party databases with annual subscription costs and access limits</li>
<li><strong>Regulatory Volatility:</strong> CBAM and ESRS specifications evolving, requiring version-controlled framework updates</li>
</ol>
<hr />
<h2 id="3-codemachine-orchestration-platform">3. CodeMachine Orchestration Platform</h2>
<h3 id="31-platform-architecture">3.1 Platform Architecture</h3>
<p><strong>CodeMachine</strong> is a CLI-native orchestration platform that transforms specification files and contextual inputs into production-ready code through coordinated multi-agent workflows. Unlike traditional code generation tools that produce monolithic outputs, CodeMachine employs:</p>
<ol>
<li><strong>Hierarchical Agent Orchestration:</strong> Specialized AI agents operate in parent-child relationships with bidirectional communication</li>
<li><strong>Runtime-Adaptable Methodologies:</strong> Dynamic workflow adjustment based on project requirements without framework modifications</li>
<li><strong>Context-Aware Task Decomposition:</strong> Intelligent breakdown of specifications into parallelizable, dependency-tracked tasks</li>
<li><strong>Verification Loops:</strong> Continuous validation of generated artifacts against specifications and cross-artifact consistency checks</li>
</ol>
<h3 id="32-core-components">3.2 Core Components</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>.codemachine/
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>├── inputs/
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>│   └── specifications.md          # Source requirements (187 pages)
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>├── artifacts/
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>│   ├── architecture/               # Generated architecture blueprints
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>│   │   ├── 01_Context_and_Drivers.md
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>│   │   ├── 02_Architecture_Overview.md
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>│   │   ├── 03_System_Structure_and_Data.md
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>│   │   ├── 04_Behavior_and_Communication.md
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>│   │   ├── 05_Operational_Architecture.md
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>│   │   ├── 06_Rationale_and_Future.md
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>│   │   └── architecture_manifest.json
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>│   ├── plan/                       # Iteration plans and task breakdowns
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>│   │   ├── 01_Plan_Overview_and_Setup.md
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>│   │   ├── 02_Iteration_I{1-5}.md
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>│   │   ├── 03_Verification_and_Glossary.md
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>│   │   └── plan_manifest.json
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>│   └── tasks/                      # Granular task specifications
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>│       ├── tasks_I1.json (11 tasks)
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>│       ├── tasks_I2.json (7 tasks)
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>│       ├── tasks_I3.json (7 tasks)
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>│       ├── tasks_I4.json (7 tasks)
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>│       ├── tasks_I5.json (7 tasks)
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>│       └── tasks_manifest.json
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>├── prompts/
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>│   ├── context.md                  # Dynamic context injection
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>│   ├── plan_fallback.md
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>│   ├── task_fallback.md
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>│   └── code_fallback.md
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>├── agents/
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>│   └── agents-config.json          # Agent type registry
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>└── template.json                   # Workflow orchestration state
</code></pre></div>
<h3 id="33-orchestration-workflow">3.3 Orchestration Workflow</h3>
<p><strong>Phase 1: Specification Analysis</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Input: specifications.md (187 pages)
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>      ↓
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>[Architecture Agent] → Analyzes requirements, identifies architectural drivers
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>      ↓
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>Output: 6 architecture blueprint documents with C4 diagrams, ERDs, sequence diagrams
</code></pre></div></p>
<p><strong>Phase 2: Strategic Planning</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Inputs: Architecture blueprints + specifications
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>      ↓
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>[Planning Agent] → Decomposes into 5 iterations with 39 tasks
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>      ↓
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>Outputs:
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>  - Iteration plans with goals and acceptance criteria
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>  - Task dependency graphs
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>  - Parallelization strategy
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>  - Verification checkpoints
</code></pre></div></p>
<p><strong>Phase 3: Task Decomposition</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Inputs: Iteration plans + architecture context
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>      ↓
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>[Task Breakdown Agent] → Creates granular task specifications
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>      ↓
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Outputs:
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>  - tasks_I{1-5}.json (39 total tasks)
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>  - Each task includes:
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    * Detailed description
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    * Target files
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    * Input files (dependencies)
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    * Acceptance criteria
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    * Agent type hint (SetupAgent, DatabaseAgent, BackendAgent, etc.)
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    * Parallelization flag
</code></pre></div></p>
<p><strong>Phase 4: Code Generation &amp; Verification</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Orchestration Workflow Steps:
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  1. [git-commit] → Commit initial project specification (Cursor, execute once)
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>  2. [arch-agent] → Define system architecture and technical design (Claude, execute once)
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>  3. [plan-agent] → Generate comprehensive iterative development plan (Claude, execute once)
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>  4. [task-breakdown] → Extract and structure tasks into JSON (Claude, execute once)
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>  5. [git-commit] → Commit task breakdown (Cursor, execute once)
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>  For each task (loop: max 20 iterations):
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    6. [context-manager] → Gather relevant context from architecture/plan/codebase (Claude)
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    7. [code-generation] → Generate code implementation (Codex)
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    8. [cleanup-code-fallback] → Delete .codemachine/prompts/code_fallback.md if present (Cursor)
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    9. [runtime-prep] → Generate shell scripts (install, run, lint, test) (Codex, execute once)
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>   10. [task-sanity-check] → Verify code against requirements (Codex)
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>   11. [git-commit] → Commit generated and verified code (Cursor)
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>   12. [check-task] → Loop back if tasks incomplete (Cursor, skip runtime-prep on loops)
</code></pre></div></p>
<h3 id="34-orchestration-agents">3.4 Orchestration Agents</h3>
<p>CodeMachine employs <strong>specialized orchestration agents</strong> with distinct AI engines:</p>
<table>
<thead>
<tr>
<th>Agent</th>
<th>Engine</th>
<th>Execution</th>
<th>Responsibilities</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>git-commit</strong></td>
<td>Cursor</td>
<td>Once/Per-task</td>
<td>Commits specifications, task breakdowns, and generated code to version control</td>
</tr>
<tr>
<td><strong>arch-agent</strong></td>
<td>Claude</td>
<td>Once</td>
<td>Analyzes requirements, defines system architecture, creates C4 diagrams, ERDs, and technical design decisions</td>
</tr>
<tr>
<td><strong>plan-agent</strong></td>
<td>Claude</td>
<td>Once</td>
<td>Generates comprehensive iterative development plan with task decomposition, dependencies, and acceptance criteria</td>
</tr>
<tr>
<td><strong>task-breakdown</strong></td>
<td>Claude</td>
<td>Once</td>
<td>Extracts and structures tasks from plan into JSON format with detailed specifications, file paths, and agent hints</td>
</tr>
<tr>
<td><strong>context-manager</strong></td>
<td>Claude</td>
<td>Per-task</td>
<td>Gathers relevant context from architecture blueprints, plan documents, and existing codebase for task execution</td>
</tr>
<tr>
<td><strong>code-generation</strong></td>
<td>Codex</td>
<td>Per-task</td>
<td>Generates implementation code including microservices, APIs, infrastructure-as-code, frontend components, and tests</td>
</tr>
<tr>
<td><strong>cleanup-code-fallback</strong></td>
<td>Cursor</td>
<td>Per-task</td>
<td>Removes temporary fallback files from prompts directory to maintain clean workflow state</td>
</tr>
<tr>
<td><strong>runtime-prep</strong></td>
<td>Codex</td>
<td>Once</td>
<td>Generates robust shell scripts for project automation (install.sh, run.sh, lint.sh, test.sh)</td>
</tr>
<tr>
<td><strong>task-sanity-check</strong></td>
<td>Codex</td>
<td>Per-task</td>
<td>Verifies generated code against task requirements, acceptance criteria, and architectural constraints</td>
</tr>
<tr>
<td><strong>check-task</strong></td>
<td>Cursor</td>
<td>Per-task</td>
<td>Evaluates task completion status and triggers loop iteration if tasks remain incomplete (max 20 iterations)</td>
</tr>
</tbody>
</table>
<p><strong>Multi-Engine Strategy:</strong>
- <strong>Claude (Sonnet 4.5):</strong> Strategic planning, architecture design, context analysis (superior reasoning)
- <strong>Codex (GPT-5 medium):</strong> Code generation, verification, runtime tooling (optimized for code synthesis)
- <strong>Cursor (Cheetah stealth model):</strong> Version control operations, cleanup tasks (file system operations)</p>
<h3 id="35-context-injection">3.5 Context Injection</h3>
<p><strong>Dynamic Context Provision:</strong>
Each agent receives task-specific context extracted from:
- Architecture blueprints (via <code>architecture_manifest.json</code> anchor references)
- Plan documents (via <code>plan_manifest.json</code> section references)
- Existing codebase analysis (CodeMachine scans modified files)
- Cross-cutting concerns (authentication, logging patterns)</p>
<p><strong>Example Context for Task I2.T1 (Document Processing Service):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="gu">### Context: component-diagram (from docs/architecture/03_System_Structure_and_Data.md)</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>Shows Document Processing Service internal components:
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="k">-</span><span class="w"> </span>Upload API Controller
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="k">-</span><span class="w"> </span>OCR Engine (PyTesseract)
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="k">-</span><span class="w"> </span>LLM Extraction Pipeline (LangChain + GPT-4)
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="k">-</span><span class="w"> </span>Validation Engine (Regulatory ruleset checker)
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="k">-</span><span class="w"> </span>Evidence Repository (S3 integration)
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="k">-</span><span class="w"> </span>Event Publisher (SQS)
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="gu">### Relevant Existing Code</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="k">-</span><span class="w"> </span>File: scripts/schema.sql:45
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>  Summary: Document table with columns: document_id, company_id, document_type,
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>           s3_key, file_size, uploaded_at, status
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>  Recommendation: Use this schema for database models; add foreign key to DocumentExtraction
</code></pre></div></p>
<hr />
<h2 id="4-architecture-technology-stack">4. Architecture &amp; Technology Stack</h2>
<h3 id="41-architectural-style">4.1 Architectural Style</h3>
<p><strong>Event-Driven Microservices Architecture</strong></p>
<p><strong>Rationale:</strong>
1. <strong>Domain Separation:</strong> 7 microservices aligned with business capabilities (Compliance, Carbon Accounting, Document Processing, Risk Assessment, Supply Chain, ESG Reporting, Notifications)
2. <strong>Asynchronous Processing:</strong> Document analysis and emissions calculations are time-intensive (violates 60s SLA if synchronous)
3. <strong>Independent Scaling:</strong> AI processing requires more compute than compliance mapping
4. <strong>Technology Diversity:</strong> Python for AI/ML workloads, Node.js for high-throughput CRUD APIs
5. <strong>Resilience:</strong> Service isolation prevents cascading failures (critical for 99.5% uptime target)</p>
<p><strong>Event Flows:</strong>
- <strong>Document Processing:</strong> Upload → OCR → LLM Extraction → Validation → Risk Update → Notification
- <strong>Carbon Calculation:</strong> Request → Supplier Fetch → Emission Factor Lookup → Calculation → Report Generation → Notification</p>
<h3 id="42-technology-stack">4.2 Technology Stack</h3>
<h4 id="frontend-layer">Frontend Layer</h4>
<ul>
<li><strong>Framework:</strong> React 18 with TypeScript</li>
<li><strong>State Management:</strong> React Query (server state), Context API (UI state)</li>
<li><strong>Styling:</strong> Tailwind CSS with custom design system</li>
<li><strong>Build Tools:</strong> Vite (fast HMR, optimized production builds)</li>
<li><strong>Internationalization:</strong> i18next (English, Arabic)</li>
</ul>
<h4 id="api-layer">API Layer</h4>
<ul>
<li><strong>Gateway:</strong> Kong Gateway (JWT validation, rate limiting, routing)</li>
<li><strong>Protocol:</strong> RESTful APIs with OpenAPI 3.1 specifications</li>
<li><strong>Documentation:</strong> Auto-generated Swagger UI and Redoc</li>
</ul>
<h4 id="backend-services">Backend Services</h4>
<p><strong>AI/ML Services (Python 3.11 + FastAPI):</strong>
- Document Processing Service
- Carbon Accounting Service
- Compliance Engine Service
- ESG Reporting Service</p>
<p><strong>CRUD APIs (Node.js 20 + NestJS):</strong>
- Risk Assessment Service
- Supply Chain Service
- Notification Service</p>
<p><strong>Key Libraries:</strong>
- <strong>AI:</strong> LangChain, OpenAI SDK, PyTesseract, PyPDF2, Pillow
- <strong>Calculations:</strong> NumPy, Pandas (emissions aggregation)
- <strong>Validation:</strong> Pydantic (FastAPI), class-validator (NestJS)</p>
<h4 id="data-layer">Data Layer</h4>
<ul>
<li><strong>Primary Database:</strong> PostgreSQL 15 (AWS RDS Multi-AZ)</li>
<li>ACID compliance for financial/regulatory data</li>
<li>JSON columns for flexible framework definitions</li>
<li>PostGIS for geospatial jurisdiction mapping</li>
<li><strong>Document Store:</strong> MongoDB Atlas (AWS DocumentDB)</li>
<li>Regulatory framework schemas (CBAM, ESRS, ISO)</li>
<li>Flexible schema for evolving regulations</li>
<li><strong>Cache:</strong> Redis 7 (AWS ElastiCache)</li>
<li>Emission factor caching (30-day TTL)</li>
<li>API response caching (5-minute TTL for dashboards)</li>
<li>Session management</li>
<li><strong>Object Storage:</strong> AWS S3</li>
<li>Document storage (invoices, EPDs, certificates)</li>
<li>Generated reports (CBAM PDFs, audit packs)</li>
<li>AES-256 encryption, versioning for audit trails</li>
<li><strong>Search Engine:</strong> Elasticsearch 8 (AWS OpenSearch)</li>
<li>Full-text search for regulations</li>
<li>Supplier lookup</li>
<li>Audit log analysis</li>
</ul>
<h4 id="message-event-layer">Message &amp; Event Layer</h4>
<ul>
<li><strong>Message Queue:</strong> Amazon SQS (Standard + FIFO queues)</li>
<li><strong>Event Bus:</strong> Amazon SNS (Pub/Sub patterns)</li>
<li><strong>Dead Letter Queue:</strong> SQS DLQ for failed message handling</li>
</ul>
<h4 id="infrastructure-deployment">Infrastructure &amp; Deployment</h4>
<ul>
<li><strong>Containerization:</strong> Docker (all microservices)</li>
<li><strong>Orchestration:</strong> Amazon EKS (Kubernetes 1.28+)</li>
<li><strong>IaC:</strong> Terraform (VPC, EKS, RDS, ElastiCache, S3, SQS modules)</li>
<li><strong>Service Mesh:</strong> Istio (mTLS, circuit breakers, distributed tracing)</li>
<li><strong>CI/CD:</strong> GitHub Actions (pipelines), ArgoCD (GitOps deployments)</li>
</ul>
<h4 id="monitoring-observability">Monitoring &amp; Observability</h4>
<ul>
<li><strong>Metrics:</strong> Prometheus + Grafana dashboards</li>
<li><strong>Logging:</strong> ELK Stack (Elasticsearch, Logstash, Kibana) + CloudWatch</li>
<li><strong>Tracing:</strong> Jaeger (distributed tracing across microservices)</li>
<li><strong>Alerting:</strong> PagerDuty (critical), Slack (warnings)</li>
</ul>
<h4 id="security-authentication">Security &amp; Authentication</h4>
<ul>
<li><strong>Identity Provider:</strong> Auth0 (OAuth2/OIDC, enterprise SSO)</li>
<li><strong>Secrets Management:</strong> HashiCorp Vault</li>
<li><strong>Security Scanning:</strong> OWASP ZAP (DAST), Snyk (dependencies), SonarQube (SAST)</li>
</ul>
<h3 id="43-data-model-overview">4.3 Data Model Overview</h3>
<p><strong>Core Entities (15 tables in PostgreSQL):</strong></p>
<p><strong>Multi-Tenancy:</strong>
- <code>Company</code>: Tenant entity (partition key <code>company_id</code>, jurisdiction, industry, target markets)
- <code>User</code>: Role-based access (admin, compliance_officer, auditor, supply_chain_manager)</p>
<p><strong>Compliance Management:</strong>
- <code>ComplianceChecklist</code>: Generated checklist per company (jurisdiction, frameworks, risk score)
- <code>ChecklistItem</code>: Individual requirements (status, evidence links, due dates)
- <code>ComplianceReport</code>: Generated reports (CBAM, ESRS, GRI) with S3 keys</p>
<p><strong>Carbon Accounting:</strong>
- <code>Product</code>: SME products (HS codes, bill of materials, unit of measure)
- <code>Supplier</code>: Supply chain entities (tier levels, location, sector)
- <code>ProductSupplier</code>: Many-to-many with quantities
- <code>EmissionCalculation</code>: Product-level footprint (Scope 1-3 breakdown, total CO₂e, quality score)
- <code>EmissionFactor</code>: Cached factors (region, sector, activity, CO₂e per unit, source, validity)</p>
<p><strong>Document Management:</strong>
- <code>Document</code>: Uploaded evidence (S3 keys, document type, metadata)
- <code>DocumentExtraction</code>: AI-extracted fields (JSON), confidence scores, validation status</p>
<p><strong>Audit &amp; Risk:</strong>
- <code>AuditLog</code>: Immutable append-only log (user actions, timestamps, IP addresses)
- <code>RiskAssessment</code>: Historical risk scores with traffic-light indicators</p>
<p><strong>MongoDB Collections:</strong>
- <code>RegulatoryFramework</code>: JSON documents (CBAM, ESRS, ISO 14064, GRI)
  - Disclosure requirements
  - Calculation methods
  - Evidence types
  - Thresholds
  - Temporal versioning (CBAM v1.0 → v1.1)</p>
<h3 id="44-api-design-principles">4.4 API Design Principles</h3>
<p><strong>RESTful Conventions:</strong>
- <strong>Resource-Oriented URLs:</strong> <code>/companies/{companyId}/products</code>, <code>/documents/{documentId}/extractions</code>
- <strong>HTTP Verbs:</strong> GET (retrieval), POST (creation), PUT (update), DELETE (removal)
- <strong>Status Codes:</strong> 200 OK, 201 Created, 202 Accepted, 400 Bad Request, 401 Unauthorized, 404 Not Found, 500 Internal Server Error
- <strong>Error Format:</strong> RFC 7807 Problem Details (<code>type</code>, <code>title</code>, <code>status</code>, <code>detail</code>)</p>
<p><strong>Asynchronous Operations:</strong>
- Long-running tasks return <code>202 Accepted</code> with <code>Location</code> header
- Clients poll status endpoint: <code>/api/v1/carbon/calculations/{id}</code> → <code>{status: "completed", result: {...}}</code></p>
<p><strong>Key Endpoints:</strong>
- <code>POST /api/v1/compliance/checklists</code> - Generate jurisdiction-specific checklist
- <code>POST /api/v1/carbon/calculations</code> - Calculate product emissions (async)
- <code>POST /api/v1/documents</code> - Upload document (returns presigned S3 URL)
- <code>POST /api/v1/documents/{id}/extract</code> - Trigger AI extraction (async)
- <code>GET /api/v1/risk/scores/{companyId}</code> - Compliance risk score</p>
<hr />
<h2 id="5-implementation-strategy">5. Implementation Strategy</h2>
<h3 id="51-iteration-based-delivery">5.1 Iteration-Based Delivery</h3>
<p><strong>Iteration 1 (Foundation):</strong> Project Setup &amp; Core Artifacts (2 weeks)
- <strong>Goal:</strong> Establish infrastructure, data models, diagrams, API specs
- <strong>Tasks:</strong> 11 tasks (Setup, Diagrams, Database, Terraform, OpenAPI, Seed Scripts, Shared Libraries)
- <strong>Deliverables:</strong>
  - Complete monorepo structure
  - PostgreSQL schema (15 tables) + MongoDB schemas
  - PlantUML diagrams (Context, Container, Component, ERD, Deployment)
  - OpenAPI 3.1 specs (5 services + consolidated)
  - Terraform modules (VPC, EKS, RDS, ElastiCache)
  - TypeScript API client (auto-generated)
  - Seed scripts (emission factors, regulatory frameworks)
  - Shared Python/Node.js libraries</p>
<p><strong>Iteration 2 (Core Services):</strong> Document Processing &amp; Carbon Accounting (2 weeks)
- <strong>Goal:</strong> Implement primary business logic for Phase 1
- <strong>Tasks:</strong> 7 tasks (Document Service APIs, OCR+LLM pipeline, Validation, Carbon calculation engine, Sequence diagrams, Postman collection, Tests)
- <strong>Deliverables:</strong>
  - Document Processing Service (S3 presigned URLs, PyTesseract OCR, GPT-4 extraction, validation engine)
  - Carbon Accounting Service (GHG Protocol calculation, CBAM report generation)
  - Sequence diagrams (Document workflow, CBAM calculation)
  - Postman collection (20+ API requests)
  - Unit + integration tests (&gt;80% coverage)</p>
<p><strong>Iteration 3 (Compliance &amp; UI):</strong> Compliance Engine, Risk, Supply Chain, Dashboard (2 weeks)
- <strong>Goal:</strong> Complete Phase 1 feature set with frontend
- <strong>Tasks:</strong> 7 tasks (Compliance Engine, Risk Service, Supply Chain Service, Notification Service, React Dashboard, E2E tests, Staging deployment)
- <strong>Deliverables:</strong>
  - Compliance Engine (framework mapping, checklist generation)
  - Risk Assessment Service (traffic-light scoring, gap analysis)
  - Supply Chain Service (supplier mapping, emission factor substitution)
  - Notification Service (email alerts, WebSocket notifications)
  - Compliance Dashboard (React, risk visualization, document uploads)
  - End-to-end integration tests
  - Deployed to AWS staging (ArgoCD)</p>
<p><strong>Iteration 4 (Production Readiness):</strong> Integration, Security, Performance (2 weeks)
- <strong>Goal:</strong> Harden system for production deployment
- <strong>Tasks:</strong> 7 tasks (Kong Gateway, CloudFront deployment, Playwright E2E, Load testing, Security scanning, Production infrastructure, UAT)
- <strong>Deliverables:</strong>
  - Kong Gateway with JWT auth and rate limiting
  - Web app on S3 + CloudFront CDN
  - Playwright E2E tests (compliance, carbon, CBAM workflows)
  - Load testing reports (k6: 1000 concurrent users)
  - OWASP ZAP security scan results
  - Blue-green deployment infrastructure
  - UAT with 5 pilot SME customers</p>
<p><strong>Iteration 5 (ESG Expansion - Planned):</strong> Full ESG Reporting (3 weeks)
- <strong>Goal:</strong> Phase 2 features - ESRS, GRI, social/governance metrics
- <strong>Tasks:</strong> 7 tasks (Data model extension, ESG Reporting Service, Social metrics, Governance metrics, ESRS/GRI report generation, ESG Dashboard, Deployment)</p>
<h3 id="52-verification-strategy">5.2 Verification Strategy</h3>
<p><strong>Artifact Validation:</strong>
- <strong>PlantUML Diagrams:</strong> Must render without syntax errors using PlantUML CLI
- <strong>OpenAPI Specs:</strong> Validated with <code>openapi-generator-cli</code> and Swagger Editor
- <strong>SQL DDL:</strong> Executed on PostgreSQL 15 without errors
- <strong>Terraform:</strong> <code>terraform validate</code> passes, <code>terraform plan</code> generates valid execution plan
- <strong>TypeScript Client:</strong> Compiles with <code>tsc</code> without errors
- <strong>Tests:</strong> &gt;80% code coverage requirement</p>
<p><strong>Cross-Artifact Consistency Checks:</strong>
- ERD entities match SQL schema tables
- OpenAPI schemas align with database models
- Sequence diagrams validated against implemented API flows
- Environment variables in Terraform outputs match service configurations</p>
<hr />
<h2 id="6-complete-project-structure">6. Complete Project Structure</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>sustaina-platform/
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>├── .github/                                    # CI/CD Workflows
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>│   └── workflows/
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>│       ├── ci-backend.yml                     # Backend tests, linting, Docker builds
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>│       ├── ci-frontend.yml                    # Frontend tests, build
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>│       ├── cd-staging.yml                     # Deploy to staging
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>│       ├── cd-production.yml                  # Deploy to production (manual)
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>│       └── cd-web-app.yml                     # Web app S3 + CloudFront deployment
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>│
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>├── services/                                   # Microservices (7 services)
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>│   ├── compliance-service/                    # Python/FastAPI
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>│   │   ├── src/
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>│   │   │   ├── api/                          # Route handlers
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>│   │   │   │   ├── __init__.py
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>│   │   │   │   ├── checklists.py             # POST/GET /checklists
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>│   │   │   │   ├── frameworks.py             # GET /frameworks
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>│   │   │   │   └── health.py
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>│   │   │   ├── core/                         # Business logic
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>│   │   │   │   ├── checklist_generator.py    # Jurisdiction-aware checklist logic
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>│   │   │   │   ├── framework_loader.py       # MongoDB framework queries
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>│   │   │   │   └── rule_engine.py            # Regulatory rule evaluation
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>│   │   │   ├── models/                       # SQLAlchemy ORM
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>│   │   │   │   ├── company.py
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>│   │   │   │   ├── checklist.py
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>│   │   │   │   └── checklist_item.py
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>│   │   │   ├── schemas/                      # Pydantic validation
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>│   │   │   │   ├── checklist_request.py
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>│   │   │   │   └── checklist_response.py
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>│   │   │   └── main.py                       # FastAPI app entry point
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>│   │   ├── tests/                            # Pytest
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>│   │   │   ├── test_checklist_generator.py
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>│   │   │   └── test_frameworks.py
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>│   │   ├── Dockerfile                        # Multi-stage build
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>│   │   ├── requirements.txt
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>│   │   └── README.md
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>│   │
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>│   ├── carbon-accounting-service/            # Python/FastAPI
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>│   │   ├── src/
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>│   │   │   ├── api/
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>│   │   │   │   ├── calculations.py           # POST /calculations, GET /calculations/{id}
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>│   │   │   │   ├── reports.py                # POST /reports/cbam
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>│   │   │   │   └── emission_factors.py
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>│   │   │   ├── core/
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>│   │   │   │   ├── ghg_calculator.py         # Scope 1-3 calculation engine
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>│   │   │   │   ├── cbam_generator.py         # CBAM PDF report generation
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>│   │   │   │   └── emission_factor_service.py
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a>│   │   │   ├── models/
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>│   │   │   │   ├── product.py
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>│   │   │   │   ├── emission_calculation.py
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a>│   │   │   │   └── emission_factor.py
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>│   │   │   ├── schemas/
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a>│   │   │   ├── workers/                      # Async workers
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>│   │   │   │   └── calculation_worker.py     # SQS consumer
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>│   │   │   └── main.py
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>│   │   ├── tests/
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a>│   │   │   ├── test_ghg_calculator.py        # Verify calculation accuracy (&lt;5% variance)
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>│   │   │   └── test_cbam_generator.py
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>│   │   ├── Dockerfile
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a>│   │   ├── requirements.txt
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a>│   │   └── README.md
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>│   │
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a>│   ├── document-processing-service/          # Python/FastAPI
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>│   │   ├── src/
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>│   │   │   ├── api/
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>│   │   │   │   ├── documents.py              # POST /documents, POST /documents/{id}/extract
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a>│   │   │   │   └── validations.py            # GET /documents/{id}/validation
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a>│   │   │   ├── core/
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a>│   │   │   │   ├── ocr.py                    # PyTesseract + PyPDF2 integration
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a>│   │   │   │   ├── llm_pipeline.py           # LangChain + GPT-4 extraction
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>│   │   │   │   ├── validator.py              # Regulatory ruleset validation
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a>│   │   │   │   └── s3_client.py              # S3 presigned URL generation
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a>│   │   │   ├── models/
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a>│   │   │   │   ├── document.py
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a>│   │   │   │   └── document_extraction.py
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a>│   │   │   ├── schemas/
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>│   │   │   ├── workers/
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a>│   │   │   │   ├── ocr_worker.py             # SQS consumer for OCR
<a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a>│   │   │   │   ├── extraction_worker.py      # SQS consumer for LLM
<a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a>│   │   │   │   └── validation_worker.py
<a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a>│   │   │   └── main.py
<a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>│   │   ├── tests/
<a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a>│   │   │   ├── test_ocr.py
<a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a>│   │   │   ├── test_llm_pipeline.py          # Mock GPT-4 calls
<a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a>│   │   │   └── test_validator.py
<a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a>│   │   ├── Dockerfile
<a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a>│   │   ├── requirements.txt
<a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>│   │   └── README.md
<a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a>│   │
<a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a>│   ├── risk-assessment-service/              # Node.js/NestJS
<a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a>│   │   ├── src/
<a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a>│   │   │   ├── controllers/
<a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a>│   │   │   │   ├── risk.controller.ts        # GET /scores/{companyId}, GET /gaps
<a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a>│   │   │   │   └── health.controller.ts
<a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a>│   │   │   ├── services/
<a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a>│   │   │   │   ├── risk-calculator.service.ts # Traffic-light scoring algorithm
<a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a>│   │   │   │   ├── gap-analyzer.service.ts    # Evidence gap detection
<a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a>│   │   │   │   └── recommendation.service.ts
<a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a>│   │   │   ├── entities/
<a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a>│   │   │   │   └── risk-assessment.entity.ts  # TypeORM entity
<a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a>│   │   │   ├── dto/
<a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a>│   │   │   │   ├── risk-score.dto.ts
<a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a>│   │   │   │   └── gap-analysis.dto.ts
<a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a>│   │   │   ├── consumers/
<a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a>│   │   │   │   └── document-validated.consumer.ts # SQS consumer
<a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a>│   │   │   └── main.ts                        # NestJS bootstrap
<a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a>│   │   ├── test/
<a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a>│   │   │   ├── risk-calculator.service.spec.ts
<a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a>│   │   │   └── gap-analyzer.service.spec.ts
<a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a>│   │   ├── Dockerfile
<a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a>│   │   ├── package.json
<a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a>│   │   ├── tsconfig.json
<a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a>│   │   └── README.md
<a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a>│   │
<a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a>│   ├── supply-chain-service/                  # Node.js/NestJS
<a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a>│   │   ├── src/
<a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a>│   │   │   ├── controllers/
<a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a>│   │   │   │   ├── suppliers.controller.ts    # CRUD /suppliers
<a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a>│   │   │   │   └── product-suppliers.controller.ts
<a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a>│   │   │   ├── services/
<a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a>│   │   │   │   ├── supplier.service.ts
<a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a>│   │   │   │   ├── product-supplier.service.ts
<a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a>│   │   │   │   └── emission-factor.service.ts # Default factor substitution
<a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a>│   │   │   ├── entities/
<a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a>│   │   │   │   ├── supplier.entity.ts
<a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a>│   │   │   │   └── product-supplier.entity.ts
<a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a>│   │   │   ├── dto/
<a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a>│   │   │   └── main.ts
<a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a>│   │   ├── test/
<a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a>│   │   ├── Dockerfile
<a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a>│   │   ├── package.json
<a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a>│   │   └── README.md
<a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a>│   │
<a id="__codelineno-6-133" name="__codelineno-6-133" href="#__codelineno-6-133"></a>│   ├── esg-reporting-service/                 # Python/FastAPI (Phase 2)
<a id="__codelineno-6-134" name="__codelineno-6-134" href="#__codelineno-6-134"></a>│   │   ├── src/
<a id="__codelineno-6-135" name="__codelineno-6-135" href="#__codelineno-6-135"></a>│   │   │   ├── api/
<a id="__codelineno-6-136" name="__codelineno-6-136" href="#__codelineno-6-136"></a>│   │   │   │   ├── materiality.py
<a id="__codelineno-6-137" name="__codelineno-6-137" href="#__codelineno-6-137"></a>│   │   │   │   ├── esg_metrics.py
<a id="__codelineno-6-138" name="__codelineno-6-138" href="#__codelineno-6-138"></a>│   │   │   │   └── reports.py                 # POST /reports/esrs, POST /reports/gri
<a id="__codelineno-6-139" name="__codelineno-6-139" href="#__codelineno-6-139"></a>│   │   │   ├── core/
<a id="__codelineno-6-140" name="__codelineno-6-140" href="#__codelineno-6-140"></a>│   │   │   │   ├── materiality_assessor.py   # Filter 74 ESRS topics → 8-12 material
<a id="__codelineno-6-141" name="__codelineno-6-141" href="#__codelineno-6-141"></a>│   │   │   │   ├── esg_calculator.py
<a id="__codelineno-6-142" name="__codelineno-6-142" href="#__codelineno-6-142"></a>│   │   │   │   └── report_generator.py
<a id="__codelineno-6-143" name="__codelineno-6-143" href="#__codelineno-6-143"></a>│   │   │   ├── models/
<a id="__codelineno-6-144" name="__codelineno-6-144" href="#__codelineno-6-144"></a>│   │   │   ├── schemas/
<a id="__codelineno-6-145" name="__codelineno-6-145" href="#__codelineno-6-145"></a>│   │   │   └── main.py
<a id="__codelineno-6-146" name="__codelineno-6-146" href="#__codelineno-6-146"></a>│   │   ├── tests/
<a id="__codelineno-6-147" name="__codelineno-6-147" href="#__codelineno-6-147"></a>│   │   ├── Dockerfile
<a id="__codelineno-6-148" name="__codelineno-6-148" href="#__codelineno-6-148"></a>│   │   ├── requirements.txt
<a id="__codelineno-6-149" name="__codelineno-6-149" href="#__codelineno-6-149"></a>│   │   └── README.md
<a id="__codelineno-6-150" name="__codelineno-6-150" href="#__codelineno-6-150"></a>│   │
<a id="__codelineno-6-151" name="__codelineno-6-151" href="#__codelineno-6-151"></a>│   └── notification-service/                  # Node.js/NestJS
<a id="__codelineno-6-152" name="__codelineno-6-152" href="#__codelineno-6-152"></a>│       ├── src/
<a id="__codelineno-6-153" name="__codelineno-6-153" href="#__codelineno-6-153"></a>│       │   ├── controllers/
<a id="__codelineno-6-154" name="__codelineno-6-154" href="#__codelineno-6-154"></a>│       │   │   └── notifications.controller.ts
<a id="__codelineno-6-155" name="__codelineno-6-155" href="#__codelineno-6-155"></a>│       │   ├── services/
<a id="__codelineno-6-156" name="__codelineno-6-156" href="#__codelineno-6-156"></a>│       │   │   ├── email.service.ts           # SendGrid/SES integration
<a id="__codelineno-6-157" name="__codelineno-6-157" href="#__codelineno-6-157"></a>│       │   │   ├── websocket.service.ts       # Socket.io for real-time notifications
<a id="__codelineno-6-158" name="__codelineno-6-158" href="#__codelineno-6-158"></a>│       │   │   └── template.service.ts
<a id="__codelineno-6-159" name="__codelineno-6-159" href="#__codelineno-6-159"></a>│       │   ├── consumers/
<a id="__codelineno-6-160" name="__codelineno-6-160" href="#__codelineno-6-160"></a>│       │   │   ├── compliance-risk-changed.consumer.ts
<a id="__codelineno-6-161" name="__codelineno-6-161" href="#__codelineno-6-161"></a>│       │   │   ├── calculation-completed.consumer.ts
<a id="__codelineno-6-162" name="__codelineno-6-162" href="#__codelineno-6-162"></a>│       │   │   └── document-validated.consumer.ts
<a id="__codelineno-6-163" name="__codelineno-6-163" href="#__codelineno-6-163"></a>│       │   ├── templates/                     # Email templates (Handlebars)
<a id="__codelineno-6-164" name="__codelineno-6-164" href="#__codelineno-6-164"></a>│       │   │   ├── compliance-alert.hbs
<a id="__codelineno-6-165" name="__codelineno-6-165" href="#__codelineno-6-165"></a>│       │   │   └── calculation-complete.hbs
<a id="__codelineno-6-166" name="__codelineno-6-166" href="#__codelineno-6-166"></a>│       │   └── main.ts
<a id="__codelineno-6-167" name="__codelineno-6-167" href="#__codelineno-6-167"></a>│       ├── test/
<a id="__codelineno-6-168" name="__codelineno-6-168" href="#__codelineno-6-168"></a>│       ├── Dockerfile
<a id="__codelineno-6-169" name="__codelineno-6-169" href="#__codelineno-6-169"></a>│       ├── package.json
<a id="__codelineno-6-170" name="__codelineno-6-170" href="#__codelineno-6-170"></a>│       └── README.md
<a id="__codelineno-6-171" name="__codelineno-6-171" href="#__codelineno-6-171"></a>│
<a id="__codelineno-6-172" name="__codelineno-6-172" href="#__codelineno-6-172"></a>├── web-app/                                    # React Frontend (SPA)
<a id="__codelineno-6-173" name="__codelineno-6-173" href="#__codelineno-6-173"></a>│   ├── public/
<a id="__codelineno-6-174" name="__codelineno-6-174" href="#__codelineno-6-174"></a>│   │   ├── favicon.ico
<a id="__codelineno-6-175" name="__codelineno-6-175" href="#__codelineno-6-175"></a>│   │   └── index.html
<a id="__codelineno-6-176" name="__codelineno-6-176" href="#__codelineno-6-176"></a>│   ├── src/
<a id="__codelineno-6-177" name="__codelineno-6-177" href="#__codelineno-6-177"></a>│   │   ├── components/                        # Reusable UI components
<a id="__codelineno-6-178" name="__codelineno-6-178" href="#__codelineno-6-178"></a>│   │   │   ├── Button.tsx
<a id="__codelineno-6-179" name="__codelineno-6-179" href="#__codelineno-6-179"></a>│   │   │   ├── Card.tsx
<a id="__codelineno-6-180" name="__codelineno-6-180" href="#__codelineno-6-180"></a>│   │   │   ├── Modal.tsx
<a id="__codelineno-6-181" name="__codelineno-6-181" href="#__codelineno-6-181"></a>│   │   │   ├── Table.tsx
<a id="__codelineno-6-182" name="__codelineno-6-182" href="#__codelineno-6-182"></a>│   │   │   └── Spinner.tsx
<a id="__codelineno-6-183" name="__codelineno-6-183" href="#__codelineno-6-183"></a>│   │   ├── features/                          # Feature modules
<a id="__codelineno-6-184" name="__codelineno-6-184" href="#__codelineno-6-184"></a>│   │   │   ├── compliance/
<a id="__codelineno-6-185" name="__codelineno-6-185" href="#__codelineno-6-185"></a>│   │   │   │   ├── ComplianceDashboard.tsx
<a id="__codelineno-6-186" name="__codelineno-6-186" href="#__codelineno-6-186"></a>│   │   │   │   ├── ChecklistView.tsx
<a id="__codelineno-6-187" name="__codelineno-6-187" href="#__codelineno-6-187"></a>│   │   │   │   └── FrameworkSelector.tsx
<a id="__codelineno-6-188" name="__codelineno-6-188" href="#__codelineno-6-188"></a>│   │   │   ├── carbon/
<a id="__codelineno-6-189" name="__codelineno-6-189" href="#__codelineno-6-189"></a>│   │   │   │   ├── ProductList.tsx
<a id="__codelineno-6-190" name="__codelineno-6-190" href="#__codelineno-6-190"></a>│   │   │   │   ├── CalculationForm.tsx
<a id="__codelineno-6-191" name="__codelineno-6-191" href="#__codelineno-6-191"></a>│   │   │   │   └── CBAMReportView.tsx
<a id="__codelineno-6-192" name="__codelineno-6-192" href="#__codelineno-6-192"></a>│   │   │   ├── documents/
<a id="__codelineno-6-193" name="__codelineno-6-193" href="#__codelineno-6-193"></a>│   │   │   │   ├── DocumentUpload.tsx
<a id="__codelineno-6-194" name="__codelineno-6-194" href="#__codelineno-6-194"></a>│   │   │   │   ├── DocumentList.tsx
<a id="__codelineno-6-195" name="__codelineno-6-195" href="#__codelineno-6-195"></a>│   │   │   │   └── ValidationStatus.tsx
<a id="__codelineno-6-196" name="__codelineno-6-196" href="#__codelineno-6-196"></a>│   │   │   ├── risk/
<a id="__codelineno-6-197" name="__codelineno-6-197" href="#__codelineno-6-197"></a>│   │   │   │   ├── RiskDashboard.tsx
<a id="__codelineno-6-198" name="__codelineno-6-198" href="#__codelineno-6-198"></a>│   │   │   │   ├── TrafficLightIndicator.tsx
<a id="__codelineno-6-199" name="__codelineno-6-199" href="#__codelineno-6-199"></a>│   │   │   │   └── GapAnalysis.tsx
<a id="__codelineno-6-200" name="__codelineno-6-200" href="#__codelineno-6-200"></a>│   │   │   └── auth/
<a id="__codelineno-6-201" name="__codelineno-6-201" href="#__codelineno-6-201"></a>│   │   │       ├── LoginPage.tsx
<a id="__codelineno-6-202" name="__codelineno-6-202" href="#__codelineno-6-202"></a>│   │   │       └── Profile.tsx
<a id="__codelineno-6-203" name="__codelineno-6-203" href="#__codelineno-6-203"></a>│   │   ├── api/                               # API client
<a id="__codelineno-6-204" name="__codelineno-6-204" href="#__codelineno-6-204"></a>│   │   │   ├── client.ts                     # Axios config + generated client wrapper
<a id="__codelineno-6-205" name="__codelineno-6-205" href="#__codelineno-6-205"></a>│   │   │   └── hooks/                        # React Query hooks
<a id="__codelineno-6-206" name="__codelineno-6-206" href="#__codelineno-6-206"></a>│   │   │       ├── useChecklists.ts
<a id="__codelineno-6-207" name="__codelineno-6-207" href="#__codelineno-6-207"></a>│   │   │       ├── useCalculations.ts
<a id="__codelineno-6-208" name="__codelineno-6-208" href="#__codelineno-6-208"></a>│   │   │       └── useDocuments.ts
<a id="__codelineno-6-209" name="__codelineno-6-209" href="#__codelineno-6-209"></a>│   │   ├── utils/
<a id="__codelineno-6-210" name="__codelineno-6-210" href="#__codelineno-6-210"></a>│   │   │   ├── formatters.ts                 # Date, number, currency formatting
<a id="__codelineno-6-211" name="__codelineno-6-211" href="#__codelineno-6-211"></a>│   │   │   └── validators.ts
<a id="__codelineno-6-212" name="__codelineno-6-212" href="#__codelineno-6-212"></a>│   │   ├── hooks/
<a id="__codelineno-6-213" name="__codelineno-6-213" href="#__codelineno-6-213"></a>│   │   │   ├── useAuth.ts
<a id="__codelineno-6-214" name="__codelineno-6-214" href="#__codelineno-6-214"></a>│   │   │   └── useToast.ts
<a id="__codelineno-6-215" name="__codelineno-6-215" href="#__codelineno-6-215"></a>│   │   ├── i18n/                             # Internationalization
<a id="__codelineno-6-216" name="__codelineno-6-216" href="#__codelineno-6-216"></a>│   │   │   ├── en.json                       # English translations
<a id="__codelineno-6-217" name="__codelineno-6-217" href="#__codelineno-6-217"></a>│   │   │   └── ar.json                       # Arabic translations
<a id="__codelineno-6-218" name="__codelineno-6-218" href="#__codelineno-6-218"></a>│   │   ├── App.tsx
<a id="__codelineno-6-219" name="__codelineno-6-219" href="#__codelineno-6-219"></a>│   │   ├── main.tsx
<a id="__codelineno-6-220" name="__codelineno-6-220" href="#__codelineno-6-220"></a>│   │   └── vite-env.d.ts
<a id="__codelineno-6-221" name="__codelineno-6-221" href="#__codelineno-6-221"></a>│   ├── tests/                                # Jest + React Testing Library
<a id="__codelineno-6-222" name="__codelineno-6-222" href="#__codelineno-6-222"></a>│   │   ├── ComplianceDashboard.test.tsx
<a id="__codelineno-6-223" name="__codelineno-6-223" href="#__codelineno-6-223"></a>│   │   └── DocumentUpload.test.tsx
<a id="__codelineno-6-224" name="__codelineno-6-224" href="#__codelineno-6-224"></a>│   ├── .env.staging                          # Environment variables
<a id="__codelineno-6-225" name="__codelineno-6-225" href="#__codelineno-6-225"></a>│   ├── .env.production
<a id="__codelineno-6-226" name="__codelineno-6-226" href="#__codelineno-6-226"></a>│   ├── package.json
<a id="__codelineno-6-227" name="__codelineno-6-227" href="#__codelineno-6-227"></a>│   ├── vite.config.ts
<a id="__codelineno-6-228" name="__codelineno-6-228" href="#__codelineno-6-228"></a>│   ├── tailwind.config.js
<a id="__codelineno-6-229" name="__codelineno-6-229" href="#__codelineno-6-229"></a>│   ├── tsconfig.json
<a id="__codelineno-6-230" name="__codelineno-6-230" href="#__codelineno-6-230"></a>│   └── README.md
<a id="__codelineno-6-231" name="__codelineno-6-231" href="#__codelineno-6-231"></a>│
<a id="__codelineno-6-232" name="__codelineno-6-232" href="#__codelineno-6-232"></a>├── infrastructure/                            # Infrastructure as Code
<a id="__codelineno-6-233" name="__codelineno-6-233" href="#__codelineno-6-233"></a>│   ├── terraform/
<a id="__codelineno-6-234" name="__codelineno-6-234" href="#__codelineno-6-234"></a>│   │   ├── environments/
<a id="__codelineno-6-235" name="__codelineno-6-235" href="#__codelineno-6-235"></a>│   │   │   ├── dev/
<a id="__codelineno-6-236" name="__codelineno-6-236" href="#__codelineno-6-236"></a>│   │   │   │   ├── main.tf                  # Wires modules for dev environment
<a id="__codelineno-6-237" name="__codelineno-6-237" href="#__codelineno-6-237"></a>│   │   │   │   ├── terraform.tfvars         # Dev-specific variables
<a id="__codelineno-6-238" name="__codelineno-6-238" href="#__codelineno-6-238"></a>│   │   │   │   └── backend.tf               # S3 backend for state
<a id="__codelineno-6-239" name="__codelineno-6-239" href="#__codelineno-6-239"></a>│   │   │   ├── staging/
<a id="__codelineno-6-240" name="__codelineno-6-240" href="#__codelineno-6-240"></a>│   │   │   │   ├── main.tf
<a id="__codelineno-6-241" name="__codelineno-6-241" href="#__codelineno-6-241"></a>│   │   │   │   ├── web-app.tf               # S3 + CloudFront for web app
<a id="__codelineno-6-242" name="__codelineno-6-242" href="#__codelineno-6-242"></a>│   │   │   │   └── terraform.tfvars
<a id="__codelineno-6-243" name="__codelineno-6-243" href="#__codelineno-6-243"></a>│   │   │   └── production/
<a id="__codelineno-6-244" name="__codelineno-6-244" href="#__codelineno-6-244"></a>│   │   │       ├── main.tf
<a id="__codelineno-6-245" name="__codelineno-6-245" href="#__codelineno-6-245"></a>│   │   │       └── terraform.tfvars
<a id="__codelineno-6-246" name="__codelineno-6-246" href="#__codelineno-6-246"></a>│   │   ├── modules/
<a id="__codelineno-6-247" name="__codelineno-6-247" href="#__codelineno-6-247"></a>│   │   │   ├── vpc/
<a id="__codelineno-6-248" name="__codelineno-6-248" href="#__codelineno-6-248"></a>│   │   │   │   ├── main.tf                  # VPC, subnets, NAT, IGW, route tables
<a id="__codelineno-6-249" name="__codelineno-6-249" href="#__codelineno-6-249"></a>│   │   │   │   ├── variables.tf
<a id="__codelineno-6-250" name="__codelineno-6-250" href="#__codelineno-6-250"></a>│   │   │   │   └── outputs.tf
<a id="__codelineno-6-251" name="__codelineno-6-251" href="#__codelineno-6-251"></a>│   │   │   ├── eks/
<a id="__codelineno-6-252" name="__codelineno-6-252" href="#__codelineno-6-252"></a>│   │   │   │   ├── main.tf                  # EKS cluster, node groups, RBAC
<a id="__codelineno-6-253" name="__codelineno-6-253" href="#__codelineno-6-253"></a>│   │   │   │   ├── variables.tf
<a id="__codelineno-6-254" name="__codelineno-6-254" href="#__codelineno-6-254"></a>│   │   │   │   └── outputs.tf
<a id="__codelineno-6-255" name="__codelineno-6-255" href="#__codelineno-6-255"></a>│   │   │   ├── rds/
<a id="__codelineno-6-256" name="__codelineno-6-256" href="#__codelineno-6-256"></a>│   │   │   │   ├── main.tf                  # PostgreSQL Multi-AZ, backups, encryption
<a id="__codelineno-6-257" name="__codelineno-6-257" href="#__codelineno-6-257"></a>│   │   │   │   ├── variables.tf
<a id="__codelineno-6-258" name="__codelineno-6-258" href="#__codelineno-6-258"></a>│   │   │   │   └── outputs.tf
<a id="__codelineno-6-259" name="__codelineno-6-259" href="#__codelineno-6-259"></a>│   │   │   ├── elasticache/
<a id="__codelineno-6-260" name="__codelineno-6-260" href="#__codelineno-6-260"></a>│   │   │   │   ├── main.tf                  # Redis cluster, cross-AZ replication
<a id="__codelineno-6-261" name="__codelineno-6-261" href="#__codelineno-6-261"></a>│   │   │   │   ├── variables.tf
<a id="__codelineno-6-262" name="__codelineno-6-262" href="#__codelineno-6-262"></a>│   │   │   │   └── outputs.tf
<a id="__codelineno-6-263" name="__codelineno-6-263" href="#__codelineno-6-263"></a>│   │   │   ├── s3/
<a id="__codelineno-6-264" name="__codelineno-6-264" href="#__codelineno-6-264"></a>│   │   │   │   ├── main.tf                  # S3 buckets (documents, backups, logs)
<a id="__codelineno-6-265" name="__codelineno-6-265" href="#__codelineno-6-265"></a>│   │   │   │   ├── variables.tf
<a id="__codelineno-6-266" name="__codelineno-6-266" href="#__codelineno-6-266"></a>│   │   │   │   └── outputs.tf
<a id="__codelineno-6-267" name="__codelineno-6-267" href="#__codelineno-6-267"></a>│   │   │   ├── s3-web-hosting/
<a id="__codelineno-6-268" name="__codelineno-6-268" href="#__codelineno-6-268"></a>│   │   │   │   ├── main.tf                  # S3 static site + CloudFront + ACM + Route53
<a id="__codelineno-6-269" name="__codelineno-6-269" href="#__codelineno-6-269"></a>│   │   │   │   ├── variables.tf
<a id="__codelineno-6-270" name="__codelineno-6-270" href="#__codelineno-6-270"></a>│   │   │   │   └── outputs.tf
<a id="__codelineno-6-271" name="__codelineno-6-271" href="#__codelineno-6-271"></a>│   │   │   ├── sqs/
<a id="__codelineno-6-272" name="__codelineno-6-272" href="#__codelineno-6-272"></a>│   │   │   │   ├── main.tf                  # SQS queues, SNS topics, DLQs
<a id="__codelineno-6-273" name="__codelineno-6-273" href="#__codelineno-6-273"></a>│   │   │   │   ├── variables.tf
<a id="__codelineno-6-274" name="__codelineno-6-274" href="#__codelineno-6-274"></a>│   │   │   │   └── outputs.tf
<a id="__codelineno-6-275" name="__codelineno-6-275" href="#__codelineno-6-275"></a>│   │   │   └── monitoring/
<a id="__codelineno-6-276" name="__codelineno-6-276" href="#__codelineno-6-276"></a>│   │   │       ├── main.tf                  # CloudWatch dashboards, alarms
<a id="__codelineno-6-277" name="__codelineno-6-277" href="#__codelineno-6-277"></a>│   │   │       ├── variables.tf
<a id="__codelineno-6-278" name="__codelineno-6-278" href="#__codelineno-6-278"></a>│   │   │       └── outputs.tf
<a id="__codelineno-6-279" name="__codelineno-6-279" href="#__codelineno-6-279"></a>│   │   └── README.md
<a id="__codelineno-6-280" name="__codelineno-6-280" href="#__codelineno-6-280"></a>│   │
<a id="__codelineno-6-281" name="__codelineno-6-281" href="#__codelineno-6-281"></a>│   ├── kubernetes/                           # Kubernetes manifests
<a id="__codelineno-6-282" name="__codelineno-6-282" href="#__codelineno-6-282"></a>│   │   ├── base/                            # Base configs
<a id="__codelineno-6-283" name="__codelineno-6-283" href="#__codelineno-6-283"></a>│   │   │   ├── namespaces.yaml
<a id="__codelineno-6-284" name="__codelineno-6-284" href="#__codelineno-6-284"></a>│   │   │   ├── rbac.yaml
<a id="__codelineno-6-285" name="__codelineno-6-285" href="#__codelineno-6-285"></a>│   │   │   ├── kong-plugins.yaml            # JWT auth, rate limiting plugins
<a id="__codelineno-6-286" name="__codelineno-6-286" href="#__codelineno-6-286"></a>│   │   │   ├── kong-routes.yaml
<a id="__codelineno-6-287" name="__codelineno-6-287" href="#__codelineno-6-287"></a>│   │   │   └── kong-health.yaml
<a id="__codelineno-6-288" name="__codelineno-6-288" href="#__codelineno-6-288"></a>│   │   ├── helm-charts/
<a id="__codelineno-6-289" name="__codelineno-6-289" href="#__codelineno-6-289"></a>│   │   │   ├── compliance-service/
<a id="__codelineno-6-290" name="__codelineno-6-290" href="#__codelineno-6-290"></a>│   │   │   │   ├── templates/
<a id="__codelineno-6-291" name="__codelineno-6-291" href="#__codelineno-6-291"></a>│   │   │   │   │   ├── deployment.yaml
<a id="__codelineno-6-292" name="__codelineno-6-292" href="#__codelineno-6-292"></a>│   │   │   │   │   ├── service.yaml
<a id="__codelineno-6-293" name="__codelineno-6-293" href="#__codelineno-6-293"></a>│   │   │   │   │   ├── ingress.yaml
<a id="__codelineno-6-294" name="__codelineno-6-294" href="#__codelineno-6-294"></a>│   │   │   │   │   ├── hpa.yaml             # Horizontal Pod Autoscaler
<a id="__codelineno-6-295" name="__codelineno-6-295" href="#__codelineno-6-295"></a>│   │   │   │   │   ├── servicemonitor.yaml  # Prometheus scraping
<a id="__codelineno-6-296" name="__codelineno-6-296" href="#__codelineno-6-296"></a>│   │   │   │   │   └── external-secret.yaml # External Secrets Operator
<a id="__codelineno-6-297" name="__codelineno-6-297" href="#__codelineno-6-297"></a>│   │   │   │   ├── values.yaml
<a id="__codelineno-6-298" name="__codelineno-6-298" href="#__codelineno-6-298"></a>│   │   │   │   ├── values-staging.yaml
<a id="__codelineno-6-299" name="__codelineno-6-299" href="#__codelineno-6-299"></a>│   │   │   │   └── Chart.yaml
<a id="__codelineno-6-300" name="__codelineno-6-300" href="#__codelineno-6-300"></a>│   │   │   ├── carbon-accounting-service/
<a id="__codelineno-6-301" name="__codelineno-6-301" href="#__codelineno-6-301"></a>│   │   │   │   └── ... (same structure)
<a id="__codelineno-6-302" name="__codelineno-6-302" href="#__codelineno-6-302"></a>│   │   │   ├── document-processing-service/
<a id="__codelineno-6-303" name="__codelineno-6-303" href="#__codelineno-6-303"></a>│   │   │   ├── risk-assessment-service/
<a id="__codelineno-6-304" name="__codelineno-6-304" href="#__codelineno-6-304"></a>│   │   │   ├── supply-chain-service/
<a id="__codelineno-6-305" name="__codelineno-6-305" href="#__codelineno-6-305"></a>│   │   │   ├── notification-service/
<a id="__codelineno-6-306" name="__codelineno-6-306" href="#__codelineno-6-306"></a>│   │   │   └── kong-gateway/
<a id="__codelineno-6-307" name="__codelineno-6-307" href="#__codelineno-6-307"></a>│   │   │       └── ... (same structure)
<a id="__codelineno-6-308" name="__codelineno-6-308" href="#__codelineno-6-308"></a>│   │   └── argocd/                          # GitOps application definitions
<a id="__codelineno-6-309" name="__codelineno-6-309" href="#__codelineno-6-309"></a>│   │       ├── staging/
<a id="__codelineno-6-310" name="__codelineno-6-310" href="#__codelineno-6-310"></a>│   │       │   ├── compliance-app.yaml
<a id="__codelineno-6-311" name="__codelineno-6-311" href="#__codelineno-6-311"></a>│   │       │   ├── carbon-app.yaml
<a id="__codelineno-6-312" name="__codelineno-6-312" href="#__codelineno-6-312"></a>│   │       │   ├── document-app.yaml
<a id="__codelineno-6-313" name="__codelineno-6-313" href="#__codelineno-6-313"></a>│   │       │   ├── risk-app.yaml
<a id="__codelineno-6-314" name="__codelineno-6-314" href="#__codelineno-6-314"></a>│   │       │   ├── supply-chain-app.yaml
<a id="__codelineno-6-315" name="__codelineno-6-315" href="#__codelineno-6-315"></a>│   │       │   └── kong-app.yaml
<a id="__codelineno-6-316" name="__codelineno-6-316" href="#__codelineno-6-316"></a>│   │       └── production/
<a id="__codelineno-6-317" name="__codelineno-6-317" href="#__codelineno-6-317"></a>│   │           └── ... (same structure)
<a id="__codelineno-6-318" name="__codelineno-6-318" href="#__codelineno-6-318"></a>│
<a id="__codelineno-6-319" name="__codelineno-6-319" href="#__codelineno-6-319"></a>├── docs/                                     # Documentation
<a id="__codelineno-6-320" name="__codelineno-6-320" href="#__codelineno-6-320"></a>│   ├── architecture/                        # Architecture blueprints
<a id="__codelineno-6-321" name="__codelineno-6-321" href="#__codelineno-6-321"></a>│   │   ├── 01_Context_and_Drivers.md
<a id="__codelineno-6-322" name="__codelineno-6-322" href="#__codelineno-6-322"></a>│   │   ├── 02_Architecture_Overview.md
<a id="__codelineno-6-323" name="__codelineno-6-323" href="#__codelineno-6-323"></a>│   │   ├── 03_System_Structure_and_Data.md
<a id="__codelineno-6-324" name="__codelineno-6-324" href="#__codelineno-6-324"></a>│   │   ├── 04_Behavior_and_Communication.md
<a id="__codelineno-6-325" name="__codelineno-6-325" href="#__codelineno-6-325"></a>│   │   ├── 05_Operational_Architecture.md
<a id="__codelineno-6-326" name="__codelineno-6-326" href="#__codelineno-6-326"></a>│   │   ├── 06_Rationale_and_Future.md
<a id="__codelineno-6-327" name="__codelineno-6-327" href="#__codelineno-6-327"></a>│   │   ├── architecture_manifest.json
<a id="__codelineno-6-328" name="__codelineno-6-328" href="#__codelineno-6-328"></a>│   │   └── README.md
<a id="__codelineno-6-329" name="__codelineno-6-329" href="#__codelineno-6-329"></a>│   ├── diagrams/                            # PlantUML diagrams
<a id="__codelineno-6-330" name="__codelineno-6-330" href="#__codelineno-6-330"></a>│   │   ├── c4-context.puml                 # System context (external actors)
<a id="__codelineno-6-331" name="__codelineno-6-331" href="#__codelineno-6-331"></a>│   │   ├── c4-container.puml               # Container diagram (microservices, DBs)
<a id="__codelineno-6-332" name="__codelineno-6-332" href="#__codelineno-6-332"></a>│   │   ├── c4-component-docprocessing.puml # Document Service internals
<a id="__codelineno-6-333" name="__codelineno-6-333" href="#__codelineno-6-333"></a>│   │   ├── erd-data-model.puml             # Entity-Relationship Diagram
<a id="__codelineno-6-334" name="__codelineno-6-334" href="#__codelineno-6-334"></a>│   │   ├── seq-document-upload.puml        # Sequence: Document workflow
<a id="__codelineno-6-335" name="__codelineno-6-335" href="#__codelineno-6-335"></a>│   │   ├── seq-cbam-calculation.puml       # Sequence: CBAM calculation
<a id="__codelineno-6-336" name="__codelineno-6-336" href="#__codelineno-6-336"></a>│   │   └── deployment-aws.puml             # AWS infrastructure deployment
<a id="__codelineno-6-337" name="__codelineno-6-337" href="#__codelineno-6-337"></a>│   ├── adr/                                 # Architectural Decision Records
<a id="__codelineno-6-338" name="__codelineno-6-338" href="#__codelineno-6-338"></a>│   │   ├── 001-event-driven-architecture.md
<a id="__codelineno-6-339" name="__codelineno-6-339" href="#__codelineno-6-339"></a>│   │   ├── 002-polyglot-persistence.md
<a id="__codelineno-6-340" name="__codelineno-6-340" href="#__codelineno-6-340"></a>│   │   ├── 003-external-llm-apis.md
<a id="__codelineno-6-341" name="__codelineno-6-341" href="#__codelineno-6-341"></a>│   │   └── README.md
<a id="__codelineno-6-342" name="__codelineno-6-342" href="#__codelineno-6-342"></a>│   ├── api-specs/
<a id="__codelineno-6-343" name="__codelineno-6-343" href="#__codelineno-6-343"></a>│   │   └── api-overview.md                 # API documentation overview
<a id="__codelineno-6-344" name="__codelineno-6-344" href="#__codelineno-6-344"></a>│   └── runbooks/
<a id="__codelineno-6-345" name="__codelineno-6-345" href="#__codelineno-6-345"></a>│       ├── deploy-staging.md               # Staging deployment procedure
<a id="__codelineno-6-346" name="__codelineno-6-346" href="#__codelineno-6-346"></a>│       ├── disaster-recovery.md            # DR procedures (RTO 4h, RPO 1h)
<a id="__codelineno-6-347" name="__codelineno-6-347" href="#__codelineno-6-347"></a>│       └── incident-response.md            # Incident handling playbook
<a id="__codelineno-6-348" name="__codelineno-6-348" href="#__codelineno-6-348"></a>│
<a id="__codelineno-6-349" name="__codelineno-6-349" href="#__codelineno-6-349"></a>├── api/                                      # OpenAPI Specifications
<a id="__codelineno-6-350" name="__codelineno-6-350" href="#__codelineno-6-350"></a>│   ├── openapi-v1.yaml                      # Consolidated spec (all services)
<a id="__codelineno-6-351" name="__codelineno-6-351" href="#__codelineno-6-351"></a>│   ├── compliance-service.yaml
<a id="__codelineno-6-352" name="__codelineno-6-352" href="#__codelineno-6-352"></a>│   ├── carbon-accounting-service.yaml
<a id="__codelineno-6-353" name="__codelineno-6-353" href="#__codelineno-6-353"></a>│   ├── document-processing-service.yaml
<a id="__codelineno-6-354" name="__codelineno-6-354" href="#__codelineno-6-354"></a>│   ├── risk-assessment-service.yaml
<a id="__codelineno-6-355" name="__codelineno-6-355" href="#__codelineno-6-355"></a>│   └── supply-chain-service.yaml
<a id="__codelineno-6-356" name="__codelineno-6-356" href="#__codelineno-6-356"></a>│
<a id="__codelineno-6-357" name="__codelineno-6-357" href="#__codelineno-6-357"></a>├── shared/                                   # Shared libraries
<a id="__codelineno-6-358" name="__codelineno-6-358" href="#__codelineno-6-358"></a>│   ├── typescript-client/                   # Auto-generated API client
<a id="__codelineno-6-359" name="__codelineno-6-359" href="#__codelineno-6-359"></a>│   │   ├── src/
<a id="__codelineno-6-360" name="__codelineno-6-360" href="#__codelineno-6-360"></a>│   │   │   ├── apis/                       # ComplianceApi, CarbonAccountingApi, etc.
<a id="__codelineno-6-361" name="__codelineno-6-361" href="#__codelineno-6-361"></a>│   │   │   ├── models/                     # Type definitions (ComplianceChecklist, Product, etc.)
<a id="__codelineno-6-362" name="__codelineno-6-362" href="#__codelineno-6-362"></a>│   │   │   └── index.ts
<a id="__codelineno-6-363" name="__codelineno-6-363" href="#__codelineno-6-363"></a>│   │   ├── package.json
<a id="__codelineno-6-364" name="__codelineno-6-364" href="#__codelineno-6-364"></a>│   │   ├── tsconfig.json
<a id="__codelineno-6-365" name="__codelineno-6-365" href="#__codelineno-6-365"></a>│   │   └── README.md
<a id="__codelineno-6-366" name="__codelineno-6-366" href="#__codelineno-6-366"></a>│   ├── python-common/                       # Shared Python utilities
<a id="__codelineno-6-367" name="__codelineno-6-367" href="#__codelineno-6-367"></a>│   │   ├── sustaina_common/
<a id="__codelineno-6-368" name="__codelineno-6-368" href="#__codelineno-6-368"></a>│   │   │   ├── __init__.py
<a id="__codelineno-6-369" name="__codelineno-6-369" href="#__codelineno-6-369"></a>│   │   │   ├── database.py                 # SQLAlchemy session factory
<a id="__codelineno-6-370" name="__codelineno-6-370" href="#__codelineno-6-370"></a>│   │   │   ├── logging.py                  # Structured JSON logging
<a id="__codelineno-6-371" name="__codelineno-6-371" href="#__codelineno-6-371"></a>│   │   │   ├── config.py                   # Environment variable loader
<a id="__codelineno-6-372" name="__codelineno-6-372" href="#__codelineno-6-372"></a>│   │   │   └── models.py                   # BaseModel (id, company_id, timestamps)
<a id="__codelineno-6-373" name="__codelineno-6-373" href="#__codelineno-6-373"></a>│   │   ├── tests/
<a id="__codelineno-6-374" name="__codelineno-6-374" href="#__codelineno-6-374"></a>│   │   ├── setup.py
<a id="__codelineno-6-375" name="__codelineno-6-375" href="#__codelineno-6-375"></a>│   │   ├── requirements.txt
<a id="__codelineno-6-376" name="__codelineno-6-376" href="#__codelineno-6-376"></a>│   │   └── README.md
<a id="__codelineno-6-377" name="__codelineno-6-377" href="#__codelineno-6-377"></a>│   └── node-common/                         # Shared Node.js utilities
<a id="__codelineno-6-378" name="__codelineno-6-378" href="#__codelineno-6-378"></a>│       ├── src/
<a id="__codelineno-6-379" name="__codelineno-6-379" href="#__codelineno-6-379"></a>│       │   ├── database.ts                 # TypeORM DataSource factory
<a id="__codelineno-6-380" name="__codelineno-6-380" href="#__codelineno-6-380"></a>│       │   ├── logging.ts                  # Winston JSON logger
<a id="__codelineno-6-381" name="__codelineno-6-381" href="#__codelineno-6-381"></a>│       │   ├── config.ts                   # dotenv loader
<a id="__codelineno-6-382" name="__codelineno-6-382" href="#__codelineno-6-382"></a>│       │   └── middleware.ts               # JWT validation, error handling
<a id="__codelineno-6-383" name="__codelineno-6-383" href="#__codelineno-6-383"></a>│       ├── tests/
<a id="__codelineno-6-384" name="__codelineno-6-384" href="#__codelineno-6-384"></a>│       ├── package.json
<a id="__codelineno-6-385" name="__codelineno-6-385" href="#__codelineno-6-385"></a>│       ├── tsconfig.json
<a id="__codelineno-6-386" name="__codelineno-6-386" href="#__codelineno-6-386"></a>│       └── README.md
<a id="__codelineno-6-387" name="__codelineno-6-387" href="#__codelineno-6-387"></a>│
<a id="__codelineno-6-388" name="__codelineno-6-388" href="#__codelineno-6-388"></a>├── scripts/                                  # Utility scripts
<a id="__codelineno-6-389" name="__codelineno-6-389" href="#__codelineno-6-389"></a>│   ├── schema.sql                           # PostgreSQL DDL (15 tables, indexes)
<a id="__codelineno-6-390" name="__codelineno-6-390" href="#__codelineno-6-390"></a>│   ├── emission-factors-schema.sql
<a id="__codelineno-6-391" name="__codelineno-6-391" href="#__codelineno-6-391"></a>│   ├── mongodb-schemas.json                 # RegulatoryFramework JSON Schema
<a id="__codelineno-6-392" name="__codelineno-6-392" href="#__codelineno-6-392"></a>│   ├── seed-emission-factors.py             # Load 30+ emission factors (DEFRA, EPA)
<a id="__codelineno-6-393" name="__codelineno-6-393" href="#__codelineno-6-393"></a>│   ├── seed-regulatory-frameworks.py        # Load CBAM, ISO 14064, GHG Protocol
<a id="__codelineno-6-394" name="__codelineno-6-394" href="#__codelineno-6-394"></a>│   ├── generate-test-data.py               # Generate sample SME data
<a id="__codelineno-6-395" name="__codelineno-6-395" href="#__codelineno-6-395"></a>│   ├── deploy-web-app.sh                   # Web app deployment script
<a id="__codelineno-6-396" name="__codelineno-6-396" href="#__codelineno-6-396"></a>│   ├── backup-databases.sh
<a id="__codelineno-6-397" name="__codelineno-6-397" href="#__codelineno-6-397"></a>│   ├── emission-data/
<a id="__codelineno-6-398" name="__codelineno-6-398" href="#__codelineno-6-398"></a>│   │   └── defra-2024-factors.csv
<a id="__codelineno-6-399" name="__codelineno-6-399" href="#__codelineno-6-399"></a>│   ├── frameworks-data/
<a id="__codelineno-6-400" name="__codelineno-6-400" href="#__codelineno-6-400"></a>│   │   ├── cbam-eu-2026.json
<a id="__codelineno-6-401" name="__codelineno-6-401" href="#__codelineno-6-401"></a>│   │   ├── iso-14064.json
<a id="__codelineno-6-402" name="__codelineno-6-402" href="#__codelineno-6-402"></a>│   │   └── ghg-protocol.json
<a id="__codelineno-6-403" name="__codelineno-6-403" href="#__codelineno-6-403"></a>│   └── migrations/
<a id="__codelineno-6-404" name="__codelineno-6-404" href="#__codelineno-6-404"></a>│       └── 001_initial_schema.sql
<a id="__codelineno-6-405" name="__codelineno-6-405" href="#__codelineno-6-405"></a>│
<a id="__codelineno-6-406" name="__codelineno-6-406" href="#__codelineno-6-406"></a>├── tests/                                    # End-to-end &amp; integration tests
<a id="__codelineno-6-407" name="__codelineno-6-407" href="#__codelineno-6-407"></a>│   ├── e2e/                                 # Playwright tests
<a id="__codelineno-6-408" name="__codelineno-6-408" href="#__codelineno-6-408"></a>│   │   ├── compliance-workflow.spec.ts     # Generate checklist → upload docs → view risk
<a id="__codelineno-6-409" name="__codelineno-6-409" href="#__codelineno-6-409"></a>│   │   ├── carbon-calculation.spec.ts      # Create product → add suppliers → calculate
<a id="__codelineno-6-410" name="__codelineno-6-410" href="#__codelineno-6-410"></a>│   │   └── cbam-report.spec.ts             # Generate CBAM report → download PDF
<a id="__codelineno-6-411" name="__codelineno-6-411" href="#__codelineno-6-411"></a>│   ├── integration/                         # Cross-service tests
<a id="__codelineno-6-412" name="__codelineno-6-412" href="#__codelineno-6-412"></a>│   │   ├── fixtures/
<a id="__codelineno-6-413" name="__codelineno-6-413" href="#__codelineno-6-413"></a>│   │   │   ├── sample-invoice.pdf
<a id="__codelineno-6-414" name="__codelineno-6-414" href="#__codelineno-6-414"></a>│   │   │   └── sample-epd.xlsx
<a id="__codelineno-6-415" name="__codelineno-6-415" href="#__codelineno-6-415"></a>│   │   ├── test_document_workflow.py        # Document upload → extraction → validation
<a id="__codelineno-6-416" name="__codelineno-6-416" href="#__codelineno-6-416"></a>│   │   └── test_calculation_accuracy.py     # Verify emission calculations
<a id="__codelineno-6-417" name="__codelineno-6-417" href="#__codelineno-6-417"></a>│   └── postman/
<a id="__codelineno-6-418" name="__codelineno-6-418" href="#__codelineno-6-418"></a>│       └── sustaina-api.postman_collection.json
<a id="__codelineno-6-419" name="__codelineno-6-419" href="#__codelineno-6-419"></a>│
<a id="__codelineno-6-420" name="__codelineno-6-420" href="#__codelineno-6-420"></a>├── .codemachine/                            # CodeMachine orchestration
<a id="__codelineno-6-421" name="__codelineno-6-421" href="#__codelineno-6-421"></a>│   ├── inputs/
<a id="__codelineno-6-422" name="__codelineno-6-422" href="#__codelineno-6-422"></a>│   │   └── specifications.md                # Source requirements (187 pages)
<a id="__codelineno-6-423" name="__codelineno-6-423" href="#__codelineno-6-423"></a>│   ├── artifacts/
<a id="__codelineno-6-424" name="__codelineno-6-424" href="#__codelineno-6-424"></a>│   │   ├── architecture/                    # Generated blueprints
<a id="__codelineno-6-425" name="__codelineno-6-425" href="#__codelineno-6-425"></a>│   │   │   └── ... (6 documents)
<a id="__codelineno-6-426" name="__codelineno-6-426" href="#__codelineno-6-426"></a>│   │   ├── plan/                            # Iteration plans
<a id="__codelineno-6-427" name="__codelineno-6-427" href="#__codelineno-6-427"></a>│   │   │   └── ... (7 documents)
<a id="__codelineno-6-428" name="__codelineno-6-428" href="#__codelineno-6-428"></a>│   │   └── tasks/                           # Task specifications
<a id="__codelineno-6-429" name="__codelineno-6-429" href="#__codelineno-6-429"></a>│   │       └── ... (5 JSON files, 39 tasks)
<a id="__codelineno-6-430" name="__codelineno-6-430" href="#__codelineno-6-430"></a>│   ├── prompts/
<a id="__codelineno-6-431" name="__codelineno-6-431" href="#__codelineno-6-431"></a>│   │   ├── context.md
<a id="__codelineno-6-432" name="__codelineno-6-432" href="#__codelineno-6-432"></a>│   │   ├── plan_fallback.md
<a id="__codelineno-6-433" name="__codelineno-6-433" href="#__codelineno-6-433"></a>│   │   ├── task_fallback.md
<a id="__codelineno-6-434" name="__codelineno-6-434" href="#__codelineno-6-434"></a>│   │   └── code_fallback.md
<a id="__codelineno-6-435" name="__codelineno-6-435" href="#__codelineno-6-435"></a>│   ├── agents/
<a id="__codelineno-6-436" name="__codelineno-6-436" href="#__codelineno-6-436"></a>│   │   └── agents-config.json
<a id="__codelineno-6-437" name="__codelineno-6-437" href="#__codelineno-6-437"></a>│   └── template.json
<a id="__codelineno-6-438" name="__codelineno-6-438" href="#__codelineno-6-438"></a>│
<a id="__codelineno-6-439" name="__codelineno-6-439" href="#__codelineno-6-439"></a>├── .gitignore
<a id="__codelineno-6-440" name="__codelineno-6-440" href="#__codelineno-6-440"></a>├── .dockerignore
<a id="__codelineno-6-441" name="__codelineno-6-441" href="#__codelineno-6-441"></a>├── .pre-commit-config.yaml                  # Pre-commit hooks (linters, formatters)
<a id="__codelineno-6-442" name="__codelineno-6-442" href="#__codelineno-6-442"></a>├── .eslintrc.js
<a id="__codelineno-6-443" name="__codelineno-6-443" href="#__codelineno-6-443"></a>├── .prettierrc
<a id="__codelineno-6-444" name="__codelineno-6-444" href="#__codelineno-6-444"></a>├── package.json                             # Root workspace (monorepo)
<a id="__codelineno-6-445" name="__codelineno-6-445" href="#__codelineno-6-445"></a>├── package-lock.json
<a id="__codelineno-6-446" name="__codelineno-6-446" href="#__codelineno-6-446"></a>├── openapitools.json                        # OpenAPI Generator config
<a id="__codelineno-6-447" name="__codelineno-6-447" href="#__codelineno-6-447"></a>├── README.md
<a id="__codelineno-6-448" name="__codelineno-6-448" href="#__codelineno-6-448"></a>├── CONTRIBUTING.md
<a id="__codelineno-6-449" name="__codelineno-6-449" href="#__codelineno-6-449"></a>└── LICENSE
</code></pre></div>
<p><strong>Directory Statistics:</strong>
- <strong>Total Directories:</strong> 147
- <strong>Total Files:</strong> 482
- <strong>Lines of Code:</strong> 60,008 (excluding dependencies)</p>
<p><strong>Code Breakdown by Language:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>Language                 Files        Code Lines
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>JSON                       44          21,155
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>Python                    118          11,915
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>Markdown                   42           8,910
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>TypeScript                 99           6,236
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>YAML                       83           5,716
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>HCL (Terraform)            19           1,693
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>PlantUML                    8             840
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>JavaScript                 22             936
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>Shell Scripts               9             879
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>HTML                        7             938
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>SQL                         5             473
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>Dockerfile                  7             139
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>Other                      19             178
</code></pre></div></p>
<hr />
<h2 id="7-key-implementation-patterns">7. Key Implementation Patterns</h2>
<h3 id="71-multi-tenancy-pattern">7.1 Multi-Tenancy Pattern</h3>
<p><strong>Row-Level Security with Partition Key:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># shared/python-common/sustaina_common/models.py</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">TIMESTAMP</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.ext.declarative</span><span class="w"> </span><span class="kn">import</span> <span class="n">declarative_base</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">BaseModel</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="n">__abstract__</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">)</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">UUID</span><span class="p">(</span><span class="n">as_uuid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Partition key</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    <span class="n">created_at</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">onupdate</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</code></pre></div></p>
<p><strong>Automatic Filtering:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># services/compliance-service/src/api/checklists.py</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">HTTPException</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">shared.python_common.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_current_user</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/checklists&quot;</span><span class="p">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_checklists</span><span class="p">(</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="n">user</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    <span class="n">db</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="p">):</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="c1"># Automatically filter by user&#39;s company_id</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="n">checklists</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ComplianceChecklist</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>        <span class="n">ComplianceChecklist</span><span class="o">.</span><span class="n">company_id</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">company_id</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    <span class="k">return</span> <span class="n">checklists</span>
</code></pre></div></p>
<h3 id="72-event-driven-workflow-pattern">7.2 Event-Driven Workflow Pattern</h3>
<p><strong>Document Processing Workflow:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># services/document-processing-service/src/workers/ocr_worker.py</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">sqs</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sqs&#39;</span><span class="p">)</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">sns</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sns&#39;</span><span class="p">)</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_document_upload_event</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="sd">    Consumes: DocumentUploaded event</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="sd">    Publishes: DocumentTextExtracted event</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    <span class="n">document_id</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;document_id&#39;</span><span class="p">]</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    <span class="n">s3_key</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;s3_key&#39;</span><span class="p">]</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    <span class="c1"># Step 1: Download from S3</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>    <span class="n">document_bytes</span> <span class="o">=</span> <span class="n">s3_client</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s1">&#39;sustaina-documents&#39;</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">s3_key</span><span class="p">)[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>    <span class="c1"># Step 2: OCR</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>    <span class="k">if</span> <span class="n">s3_key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.pdf&#39;</span><span class="p">):</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">extract_text_from_pdf</span><span class="p">(</span><span class="n">document_bytes</span><span class="p">)</span>  <span class="c1"># PyPDF2</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">extract_text_from_image</span><span class="p">(</span><span class="n">document_bytes</span><span class="p">)</span>  <span class="c1"># PyTesseract</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>    <span class="c1"># Step 3: Store extracted text</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>    <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Document</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Document</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">document_id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;extracted_text&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">})</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>    <span class="c1"># Step 4: Publish event for LLM extraction</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>    <span class="n">sns</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>        <span class="n">TopicArn</span><span class="o">=</span><span class="s1">&#39;arn:aws:sns:eu-central-1:123456789:document-text-extracted&#39;</span><span class="p">,</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>        <span class="n">Message</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;document_id&#39;</span><span class="p">:</span> <span class="n">document_id</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">})</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>    <span class="p">)</span>
</code></pre></div></p>
<h3 id="73-ai-extraction-pattern-with-confidence-scoring">7.3 AI Extraction Pattern with Confidence Scoring</h3>
<p><strong>LLM Pipeline:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># services/document-processing-service/src/core/llm_pipeline.py</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">langchain</span><span class="w"> </span><span class="kn">import</span> <span class="n">PromptTemplate</span><span class="p">,</span> <span class="n">LLMChain</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">langchain.llms</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAI</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_invoice_fields</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="sd">    Extract structured fields from invoice text using GPT-4</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="sd">    Returns: {fields: dict, confidence_scores: dict}</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="n">prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="s2">        Extract the following fields from this invoice:</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="s2">        - supplier_name</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="s2">        - supplier_location (country)</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="s2">        - total_amount (numeric value only)</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="s2">        - invoice_date (ISO 8601 format)</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="s2">        - line_items (array of {description, quantity, unit_price})</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="s2">        Respond ONLY with valid JSON. For each field, provide a confidence score (0-1).</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="s2">        Invoice text:</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="s2">        </span><span class="si">{text}</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="s2">        JSON:</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>    <span class="p">)</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>    <span class="n">llm</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Low temp for consistency</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>    <span class="n">chain</span> <span class="o">=</span> <span class="n">LLMChain</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>    <span class="n">parsed</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>    <span class="c1"># Separate fields and confidence scores</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>    <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parsed</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>    <span class="n">confidence_scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parsed</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>    <span class="k">return</span> <span class="n">fields</span><span class="p">,</span> <span class="n">confidence_scores</span>
</code></pre></div></p>
<p><strong>Human-in-the-Loop for Low Confidence:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># services/document-processing-service/src/core/validator.py</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_extraction</span><span class="p">(</span><span class="n">document_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">confidence_scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="sd">    Flag extractions with low confidence for human review</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">CONFIDENCE_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.8</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    <span class="n">low_confidence_fields</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>        <span class="n">field</span> <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">confidence_scores</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>        <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">CONFIDENCE_THRESHOLD</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    <span class="p">]</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    <span class="k">if</span> <span class="n">low_confidence_fields</span><span class="p">:</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>        <span class="c1"># Create review task</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>        <span class="n">db</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ReviewTask</span><span class="p">(</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>            <span class="n">document_id</span><span class="o">=</span><span class="n">document_id</span><span class="p">,</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>            <span class="n">status</span><span class="o">=</span><span class="s1">&#39;pending_review&#39;</span><span class="p">,</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>            <span class="n">flagged_fields</span><span class="o">=</span><span class="n">low_confidence_fields</span><span class="p">,</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Low confidence on: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">low_confidence_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>        <span class="p">))</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>        <span class="c1"># Notify admin</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>        <span class="n">sns</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>            <span class="n">TopicArn</span><span class="o">=</span><span class="s1">&#39;arn:aws:sns:eu-central-1:123456789:admin-review-required&#39;</span><span class="p">,</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>            <span class="n">Message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Document </span><span class="si">{</span><span class="n">document_id</span><span class="si">}</span><span class="s2"> requires human review&quot;</span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>        <span class="p">)</span>
</code></pre></div></p>
<h3 id="74-carbon-calculation-pattern">7.4 Carbon Calculation Pattern</h3>
<p><strong>GHG Protocol Implementation:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># services/carbon-accounting-service/src/core/ghg_calculator.py</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">GHGCalculator</span><span class="p">:</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_product_emissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmissionCalculation</span><span class="p">:</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="sd">        Calculate Scope 1-3 emissions for a product</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        <span class="c1"># Fetch product with suppliers</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        <span class="n">product</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Product</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Product</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">product_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>        <span class="n">suppliers</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">suppliers</span>  <span class="c1"># Many-to-many relationship</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>        <span class="c1"># Scope 1: Direct manufacturing emissions</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        <span class="n">scope1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_scope1</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>        <span class="c1"># Scope 2: Purchased energy emissions</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>        <span class="n">scope2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_scope2</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>        <span class="c1"># Scope 3: Supply chain emissions (recursive)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>        <span class="n">scope3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_scope3</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">suppliers</span><span class="p">)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>        <span class="n">total_co2e</span> <span class="o">=</span> <span class="n">scope1</span> <span class="o">+</span> <span class="n">scope2</span> <span class="o">+</span> <span class="n">scope3</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>        <span class="c1"># Data quality score (higher if using supplier-specific data vs defaults)</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>        <span class="n">quality_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_data_quality</span><span class="p">(</span><span class="n">suppliers</span><span class="p">)</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>        <span class="c1"># Save calculation</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>        <span class="n">calculation</span> <span class="o">=</span> <span class="n">EmissionCalculation</span><span class="p">(</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>            <span class="n">product_id</span><span class="o">=</span><span class="n">product_id</span><span class="p">,</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>            <span class="n">scope1_co2e</span><span class="o">=</span><span class="n">scope1</span><span class="p">,</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>            <span class="n">scope2_co2e</span><span class="o">=</span><span class="n">scope2</span><span class="p">,</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>            <span class="n">scope3_co2e</span><span class="o">=</span><span class="n">scope3</span><span class="p">,</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>            <span class="n">total_co2e</span><span class="o">=</span><span class="n">total_co2e</span><span class="p">,</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>            <span class="n">data_quality_score</span><span class="o">=</span><span class="n">quality_score</span><span class="p">,</span>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a>            <span class="n">calculation_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>        <span class="p">)</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>        <span class="n">db</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">calculation</span><span class="p">)</span>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>        <span class="k">return</span> <span class="n">calculation</span>
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_scope3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product</span><span class="p">:</span> <span class="n">Product</span><span class="p">,</span> <span class="n">suppliers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Supplier</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Decimal</span><span class="p">:</span>
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a><span class="sd">        Aggregate supplier emissions (multi-tier supply chain)</span>
<a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a>        <span class="n">scope3_total</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a>
<a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a>        <span class="k">for</span> <span class="n">supplier</span> <span class="ow">in</span> <span class="n">suppliers</span><span class="p">:</span>
<a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a>            <span class="c1"># Get product-supplier link (quantity used)</span>
<a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a>            <span class="n">link</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ProductSupplier</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
<a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a>                <span class="n">ProductSupplier</span><span class="o">.</span><span class="n">product_id</span> <span class="o">==</span> <span class="n">product</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a>                <span class="n">ProductSupplier</span><span class="o">.</span><span class="n">supplier_id</span> <span class="o">==</span> <span class="n">supplier</span><span class="o">.</span><span class="n">id</span>
<a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a>            <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a>
<a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a>            <span class="n">quantity</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">quantity</span>
<a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a>
<a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a>            <span class="c1"># Lookup emission factor</span>
<a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a>            <span class="n">emission_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_emission_factor</span><span class="p">(</span>
<a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a>                <span class="n">region</span><span class="o">=</span><span class="n">supplier</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
<a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a>                <span class="n">sector</span><span class="o">=</span><span class="n">supplier</span><span class="o">.</span><span class="n">industry_sector</span><span class="p">,</span>
<a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a>                <span class="n">activity</span><span class="o">=</span><span class="n">link</span><span class="o">.</span><span class="n">activity</span>  <span class="c1"># e.g., &quot;cement production&quot;</span>
<a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>            <span class="p">)</span>
<a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>
<a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a>            <span class="c1"># Calculate emissions for this supplier</span>
<a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a>            <span class="n">supplier_emissions</span> <span class="o">=</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">emission_factor</span><span class="o">.</span><span class="n">co2e_per_unit</span>
<a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a>
<a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a>            <span class="n">scope3_total</span> <span class="o">+=</span> <span class="n">supplier_emissions</span>
<a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a>
<a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a>        <span class="k">return</span> <span class="n">scope3_total</span>
<a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a>
<a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_emission_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">activity</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmissionFactor</span><span class="p">:</span>
<a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a><span class="sd">        Fetch emission factor with Redis caching</span>
<a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ef:</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">sector</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">activity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>
<a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>        <span class="c1"># Try cache first</span>
<a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>        <span class="n">cached</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a>        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
<a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a>            <span class="k">return</span> <span class="n">EmissionFactor</span><span class="p">(</span><span class="o">**</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">cached</span><span class="p">))</span>
<a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a>
<a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a>        <span class="c1"># Query database</span>
<a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a>        <span class="n">factor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">EmissionFactor</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
<a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a>            <span class="n">EmissionFactor</span><span class="o">.</span><span class="n">region</span> <span class="o">==</span> <span class="n">region</span><span class="p">,</span>
<a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a>            <span class="n">EmissionFactor</span><span class="o">.</span><span class="n">industry_sector</span> <span class="o">==</span> <span class="n">sector</span><span class="p">,</span>
<a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a>            <span class="n">EmissionFactor</span><span class="o">.</span><span class="n">activity</span> <span class="o">==</span> <span class="n">activity</span>
<a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a>        <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a>
<a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">factor</span><span class="p">:</span>
<a id="__codelineno-13-90" name="__codelineno-13-90" href="#__codelineno-13-90"></a>            <span class="c1"># Substitution logic: fallback to default factor</span>
<a id="__codelineno-13-91" name="__codelineno-13-91" href="#__codelineno-13-91"></a>            <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_emission_factor</span><span class="p">(</span><span class="n">sector</span><span class="p">,</span> <span class="n">activity</span><span class="p">)</span>
<a id="__codelineno-13-92" name="__codelineno-13-92" href="#__codelineno-13-92"></a>
<a id="__codelineno-13-93" name="__codelineno-13-93" href="#__codelineno-13-93"></a>        <span class="c1"># Cache for 30 days</span>
<a id="__codelineno-13-94" name="__codelineno-13-94" href="#__codelineno-13-94"></a>        <span class="n">redis</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">factor</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()))</span>
<a id="__codelineno-13-95" name="__codelineno-13-95" href="#__codelineno-13-95"></a>
<a id="__codelineno-13-96" name="__codelineno-13-96" href="#__codelineno-13-96"></a>        <span class="k">return</span> <span class="n">factor</span>
</code></pre></div></p>
<h3 id="75-infrastructure-as-code-pattern">7.5 Infrastructure as Code Pattern</h3>
<p><strong>Terraform Module for S3 + CloudFront:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># infrastructure/terraform/modules/s3-web-hosting/main.tf</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;web_app&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sustaina-web-app-${var.environment}&quot;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sustaina Web App&quot;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="p">}</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_public_access_block&quot;</span><span class="w"> </span><span class="nv">&quot;web_app&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.web_app.id</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">  </span><span class="na">block_public_acls</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="c1">  # Security: No public ACLs</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">  </span><span class="na">block_public_policy</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">  </span><span class="na">ignore_public_acls</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">  </span><span class="na">restrict_public_buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="p">}</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_website_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;web_app&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.web_app.id</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w">  </span><span class="nb">index_document</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w">    </span><span class="na">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="w">  </span><span class="nb">error_document</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w">    </span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span><span class="c1">  # SPA routing</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="p">}</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="c1"># CloudFront Origin Access Control (OAC)</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_origin_access_control&quot;</span><span class="w"> </span><span class="nv">&quot;web_app&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="w">  </span><span class="na">name</span><span class="w">                              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sustaina-web-app-${var.environment}&quot;</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="w">  </span><span class="na">origin_access_control_origin_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3&quot;</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="w">  </span><span class="na">signing_behavior</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;always&quot;</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="w">  </span><span class="na">signing_protocol</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sigv4&quot;</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="p">}</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="c1"># ACM Certificate (must be in us-east-1 for CloudFront)</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_acm_certificate&quot;</span><span class="w"> </span><span class="nv">&quot;web_app&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="w">  </span><span class="na">provider</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">aws.us_east_1</span><span class="c1">  # Alias provider</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="w">  </span><span class="na">domain_name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="w">  </span><span class="na">validation_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DNS&quot;</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a><span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a><span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a><span class="p">}</span>
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a><span class="c1"># CloudFront Distribution</span>
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_distribution&quot;</span><span class="w"> </span><span class="nv">&quot;web_app&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a><span class="w">  </span><span class="na">enabled</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="w">  </span><span class="na">is_ipv6_enabled</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="w">  </span><span class="na">default_root_object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
<a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="w">  </span><span class="na">aliases</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">var.domain_name</span><span class="p">]</span>
<a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a>
<a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a><span class="w">  </span><span class="nb">origin</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a><span class="w">    </span><span class="na">domain_name</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.web_app.bucket_regional_domain_name</span>
<a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a><span class="w">    </span><span class="na">origin_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${aws_s3_bucket.web_app.id}&quot;</span>
<a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a><span class="w">    </span><span class="na">origin_access_control_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_origin_access_control.web_app.id</span>
<a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a>
<a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a><span class="w">  </span><span class="nb">default_cache_behavior</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;</span><span class="p">]</span>
<a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a><span class="w">    </span><span class="na">cached_methods</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
<a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a><span class="w">    </span><span class="na">target_origin_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${aws_s3_bucket.web_app.id}&quot;</span>
<a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a>
<a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a><span class="w">    </span><span class="nb">forwarded_values</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a><span class="w">      </span><span class="na">query_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a><span class="w">      </span><span class="nb">cookies</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a><span class="w">        </span><span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
<a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a>
<a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a><span class="w">    </span><span class="na">viewer_protocol_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;redirect-to-https&quot;</span>
<a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a><span class="w">    </span><span class="na">min_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a><span class="w">    </span><span class="na">default_ttl</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="c1">      # index.html not cached</span>
<a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a><span class="w">    </span><span class="na">max_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a>
<a id="__codelineno-14-82" name="__codelineno-14-82" href="#__codelineno-14-82"></a><span class="c1">  # Cache static assets (JS, CSS) for 1 year</span>
<a id="__codelineno-14-83" name="__codelineno-14-83" href="#__codelineno-14-83"></a><span class="w">  </span><span class="nb">ordered_cache_behavior</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-84" name="__codelineno-14-84" href="#__codelineno-14-84"></a><span class="w">    </span><span class="na">path_pattern</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/assets/*&quot;</span>
<a id="__codelineno-14-85" name="__codelineno-14-85" href="#__codelineno-14-85"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
<a id="__codelineno-14-86" name="__codelineno-14-86" href="#__codelineno-14-86"></a><span class="w">    </span><span class="na">cached_methods</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
<a id="__codelineno-14-87" name="__codelineno-14-87" href="#__codelineno-14-87"></a><span class="w">    </span><span class="na">target_origin_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${aws_s3_bucket.web_app.id}&quot;</span>
<a id="__codelineno-14-88" name="__codelineno-14-88" href="#__codelineno-14-88"></a>
<a id="__codelineno-14-89" name="__codelineno-14-89" href="#__codelineno-14-89"></a><span class="w">    </span><span class="nb">forwarded_values</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-90" name="__codelineno-14-90" href="#__codelineno-14-90"></a><span class="w">      </span><span class="na">query_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<a id="__codelineno-14-91" name="__codelineno-14-91" href="#__codelineno-14-91"></a><span class="w">      </span><span class="nb">cookies</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-92" name="__codelineno-14-92" href="#__codelineno-14-92"></a><span class="w">        </span><span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
<a id="__codelineno-14-93" name="__codelineno-14-93" href="#__codelineno-14-93"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-14-94" name="__codelineno-14-94" href="#__codelineno-14-94"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-95" name="__codelineno-14-95" href="#__codelineno-14-95"></a>
<a id="__codelineno-14-96" name="__codelineno-14-96" href="#__codelineno-14-96"></a><span class="w">    </span><span class="na">viewer_protocol_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;redirect-to-https&quot;</span>
<a id="__codelineno-14-97" name="__codelineno-14-97" href="#__codelineno-14-97"></a><span class="w">    </span><span class="na">min_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">31536000</span><span class="c1">  # 1 year</span>
<a id="__codelineno-14-98" name="__codelineno-14-98" href="#__codelineno-14-98"></a><span class="w">    </span><span class="na">default_ttl</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">31536000</span>
<a id="__codelineno-14-99" name="__codelineno-14-99" href="#__codelineno-14-99"></a><span class="w">    </span><span class="na">max_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">31536000</span>
<a id="__codelineno-14-100" name="__codelineno-14-100" href="#__codelineno-14-100"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-101" name="__codelineno-14-101" href="#__codelineno-14-101"></a>
<a id="__codelineno-14-102" name="__codelineno-14-102" href="#__codelineno-14-102"></a><span class="w">  </span><span class="nb">viewer_certificate</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-103" name="__codelineno-14-103" href="#__codelineno-14-103"></a><span class="w">    </span><span class="na">acm_certificate_arn</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_acm_certificate.web_app.arn</span>
<a id="__codelineno-14-104" name="__codelineno-14-104" href="#__codelineno-14-104"></a><span class="w">    </span><span class="na">ssl_support_method</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sni-only&quot;</span>
<a id="__codelineno-14-105" name="__codelineno-14-105" href="#__codelineno-14-105"></a><span class="w">    </span><span class="na">minimum_protocol_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TLSv1.2_2021&quot;</span>
<a id="__codelineno-14-106" name="__codelineno-14-106" href="#__codelineno-14-106"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-107" name="__codelineno-14-107" href="#__codelineno-14-107"></a>
<a id="__codelineno-14-108" name="__codelineno-14-108" href="#__codelineno-14-108"></a><span class="w">  </span><span class="nb">restrictions</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-109" name="__codelineno-14-109" href="#__codelineno-14-109"></a><span class="w">    </span><span class="nb">geo_restriction</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-110" name="__codelineno-14-110" href="#__codelineno-14-110"></a><span class="w">      </span><span class="na">restriction_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
<a id="__codelineno-14-111" name="__codelineno-14-111" href="#__codelineno-14-111"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-112" name="__codelineno-14-112" href="#__codelineno-14-112"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-113" name="__codelineno-14-113" href="#__codelineno-14-113"></a>
<a id="__codelineno-14-114" name="__codelineno-14-114" href="#__codelineno-14-114"></a><span class="w">  </span><span class="nb">logging_config</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-115" name="__codelineno-14-115" href="#__codelineno-14-115"></a><span class="w">    </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.cloudfront_logs.bucket_domain_name</span>
<a id="__codelineno-14-116" name="__codelineno-14-116" href="#__codelineno-14-116"></a><span class="w">    </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;web-app/&quot;</span>
<a id="__codelineno-14-117" name="__codelineno-14-117" href="#__codelineno-14-117"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-118" name="__codelineno-14-118" href="#__codelineno-14-118"></a><span class="p">}</span>
<a id="__codelineno-14-119" name="__codelineno-14-119" href="#__codelineno-14-119"></a>
<a id="__codelineno-14-120" name="__codelineno-14-120" href="#__codelineno-14-120"></a><span class="c1"># Route 53 DNS Record</span>
<a id="__codelineno-14-121" name="__codelineno-14-121" href="#__codelineno-14-121"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;web_app&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-122" name="__codelineno-14-122" href="#__codelineno-14-122"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.route53_zone_id</span>
<a id="__codelineno-14-123" name="__codelineno-14-123" href="#__codelineno-14-123"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
<a id="__codelineno-14-124" name="__codelineno-14-124" href="#__codelineno-14-124"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A&quot;</span>
<a id="__codelineno-14-125" name="__codelineno-14-125" href="#__codelineno-14-125"></a>
<a id="__codelineno-14-126" name="__codelineno-14-126" href="#__codelineno-14-126"></a><span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-127" name="__codelineno-14-127" href="#__codelineno-14-127"></a><span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.web_app.domain_name</span>
<a id="__codelineno-14-128" name="__codelineno-14-128" href="#__codelineno-14-128"></a><span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.web_app.hosted_zone_id</span>
<a id="__codelineno-14-129" name="__codelineno-14-129" href="#__codelineno-14-129"></a><span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<a id="__codelineno-14-130" name="__codelineno-14-130" href="#__codelineno-14-130"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-131" name="__codelineno-14-131" href="#__codelineno-14-131"></a><span class="p">}</span>
<a id="__codelineno-14-132" name="__codelineno-14-132" href="#__codelineno-14-132"></a>
<a id="__codelineno-14-133" name="__codelineno-14-133" href="#__codelineno-14-133"></a><span class="c1"># Outputs for CI/CD</span>
<a id="__codelineno-14-134" name="__codelineno-14-134" href="#__codelineno-14-134"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;distribution_id&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-135" name="__codelineno-14-135" href="#__codelineno-14-135"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.web_app.id</span>
<a id="__codelineno-14-136" name="__codelineno-14-136" href="#__codelineno-14-136"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CloudFront distribution ID for cache invalidation&quot;</span>
<a id="__codelineno-14-137" name="__codelineno-14-137" href="#__codelineno-14-137"></a><span class="p">}</span>
<a id="__codelineno-14-138" name="__codelineno-14-138" href="#__codelineno-14-138"></a>
<a id="__codelineno-14-139" name="__codelineno-14-139" href="#__codelineno-14-139"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;bucket_name&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-140" name="__codelineno-14-140" href="#__codelineno-14-140"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.web_app.id</span>
<a id="__codelineno-14-141" name="__codelineno-14-141" href="#__codelineno-14-141"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3 bucket name for deployment&quot;</span>
<a id="__codelineno-14-142" name="__codelineno-14-142" href="#__codelineno-14-142"></a><span class="p">}</span>
</code></pre></div></p>
<hr />
<h2 id="8-results-deliverables">8. Results &amp; Deliverables</h2>
<h3 id="81-completed-deliverables">8.1 Completed Deliverables</h3>
<p><strong>Infrastructure &amp; DevOps:</strong>
- ✅ 5 Terraform modules (VPC, EKS, RDS, ElastiCache, S3-Web-Hosting)
- ✅ 7 Helm charts (7 microservices)
- ✅ 6 ArgoCD application definitions
- ✅ 4 GitHub Actions workflows (CI backend, CI frontend, CD staging, CD web-app)
- ✅ Multi-region deployment (EU-Central-1, ME-South-1)
- ✅ Blue-green deployment infrastructure</p>
<p><strong>Backend Services:</strong>
- ✅ 7 microservices (Compliance, Carbon Accounting, Document Processing, Risk Assessment, Supply Chain, ESG Reporting, Notification)
- ✅ 42 API endpoints (RESTful, OpenAPI 3.1 documented)
- ✅ PostgreSQL schema (15 tables, 32 indexes, row-level security)
- ✅ MongoDB regulatory framework schemas (CBAM, ISO 14064, GHG Protocol)
- ✅ Redis caching layer (emission factors, API responses)
- ✅ SQS/SNS event-driven workflows (document processing, calculations)
- ✅ AI document processing pipeline (PyTesseract OCR + GPT-4 extraction)
- ✅ GHG Protocol carbon calculation engine (Scopes 1-3)
- ✅ CBAM report generation (PDF with standardized templates)
- ✅ Traffic-light risk scoring algorithm</p>
<p><strong>Frontend:</strong>
- ✅ React 18 web application (TypeScript)
- ✅ 5 feature modules (Compliance, Carbon, Documents, Risk, Auth)
- ✅ 15+ reusable UI components (Button, Card, Modal, Table, etc.)
- ✅ React Query for server state management
- ✅ Tailwind CSS design system
- ✅ i18next internationalization (English, Arabic)
- ✅ Deployed to S3 + CloudFront CDN</p>
<p><strong>Testing &amp; Quality:</strong>
- ✅ Unit tests (&gt;80% coverage across services)
- ✅ Integration tests (cross-service workflows)
- ✅ Playwright E2E tests (compliance workflow, carbon calculation, CBAM report)
- ✅ Postman collection (45 API requests with examples)
- ✅ Load testing reports (k6: 1000 concurrent users, &lt;60s response time)
- ✅ OWASP ZAP security scan (0 high-severity vulnerabilities)</p>
<p><strong>Documentation:</strong>
- ✅ 6 architecture blueprint documents (187 pages)
- ✅ 7 PlantUML diagrams (Context, Container, Component, ERD, 2 Sequence, Deployment)
- ✅ 6 OpenAPI 3.1 specifications (5 services + consolidated)
- ✅ 3 Architectural Decision Records (ADRs)
- ✅ 4 operational runbooks (deploy, disaster recovery, incident response)
- ✅ Auto-generated API documentation (Swagger UI, Redoc)</p>
<p><strong>Data &amp; Configuration:</strong>
- ✅ 30+ emission factors (DEFRA, EPA datasets)
- ✅ 3 regulatory framework definitions (CBAM, ISO 14064, GHG Protocol)
- ✅ Sample test data (5 SME companies, 20 products, 50 suppliers)</p>
<h3 id="82-visual-deliverables">8.2 Visual Deliverables</h3>
<p><strong>C4 Architecture Diagrams:</strong>
1. <strong>System Context Diagram:</strong> Shows Sustaina platform boundary with external actors (SME users, auditors, supply chain managers) and systems (LLM providers, emission databases, Auth0, email service)
2. <strong>Container Diagram:</strong> Illustrates 7 microservices, API Gateway, Web App, 4 databases (PostgreSQL, MongoDB, Redis, S3), message queue (SQS/SNS), search engine (Elasticsearch)
3. <strong>Component Diagram (Document Processing Service):</strong> Details OCR Engine, LLM Pipeline, Validation Engine, Evidence Repository, Event Publisher
4. <strong>Deployment Diagram:</strong> AWS infrastructure across 3 availability zones (VPC, subnets, ALB, EKS nodes, RDS Multi-AZ, ElastiCache, S3, SQS)</p>
<p><strong>Data Model:</strong>
- <strong>ERD:</strong> 15 entities with relationships (Company → Users, Products → Suppliers, Documents → Extractions, Checklists → Items)</p>
<p><strong>Workflow Diagrams:</strong>
1. <strong>Document Upload Sequence:</strong> User → Upload → OCR → LLM Extraction → Validation → Risk Update → Notification
2. <strong>CBAM Calculation Sequence:</strong> User → Calculation Request → Supplier Fetch → Emission Factor Lookup → Calculate → Report Generation → Notification</p>
<h3 id="83-code-quality-metrics">8.3 Code Quality Metrics</h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Achieved</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Test Coverage</strong></td>
<td>&gt;80%</td>
<td>84% (Backend), 78% (Frontend)</td>
</tr>
<tr>
<td><strong>API Response Time</strong></td>
<td>&lt;60s (calculations)</td>
<td>42s average (100 suppliers)</td>
</tr>
<tr>
<td><strong>AI Extraction Accuracy</strong></td>
<td>&gt;90% (structured), &gt;80% (semi-structured)</td>
<td>94% (invoices), 83% (scanned PDFs)</td>
</tr>
<tr>
<td><strong>Uptime (Staging)</strong></td>
<td>99.5%</td>
<td>99.7% (30-day average)</td>
</tr>
<tr>
<td><strong>Build Time (CI)</strong></td>
<td>&lt;10 minutes</td>
<td>7.5 minutes (parallel jobs)</td>
</tr>
<tr>
<td><strong>Docker Image Size</strong></td>
<td>&lt;500MB per service</td>
<td>280MB average (multi-stage builds)</td>
</tr>
<tr>
<td><strong>OpenAPI Compliance</strong></td>
<td>100% endpoints documented</td>
<td>100% (42/42 endpoints)</td>
</tr>
<tr>
<td><strong>Security Vulnerabilities</strong></td>
<td>0 critical/high</td>
<td>0 high, 2 medium (false positives)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="9-technical-metrics">9. Technical Metrics</h2>
<h3 id="91-development-velocity-automation-metrics">9.1 Development Velocity &amp; Automation Metrics</h3>
<p><strong>Total Project Timeline:</strong> 10 weeks (Fully automated development)</p>
<p><strong>Phase-by-Phase Breakdown:</strong></p>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Time Investment</th>
<th>Key Deliverables</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Architecture Planning</strong></td>
<td>30 minutes</td>
<td>System architecture, C4 diagrams, ERDs, technical design decisions</td>
</tr>
<tr>
<td><strong>Service Implementation</strong></td>
<td>5 hours</td>
<td>7 microservices with 42 API endpoints, 60,008 lines of code across 482 files</td>
</tr>
<tr>
<td><strong>Integration &amp; Testing</strong></td>
<td>2 hours</td>
<td>Automated validation, unit tests, integration tests, E2E workflows</td>
</tr>
<tr>
<td><strong>Deployment Setup</strong></td>
<td>30 minutes</td>
<td>Terraform modules, Helm charts, CI/CD pipelines, runtime automation scripts</td>
</tr>
<tr>
<td><strong>Total Active Development</strong></td>
<td>~8 hours</td>
<td>Complete production-ready platform</td>
</tr>
</tbody>
</table>
<p><strong>Development Efficiency:</strong>
- <strong>Efficiency Gain:</strong> 25-37× faster than traditional development
- <strong>Code Consistency:</strong> Unified architecture and patterns across all 7 microservices
- <strong>Quality Control:</strong> Built-in validation at each step with automated sanity checks
- <strong>Context Retention:</strong> Full project context maintained with cross-service awareness throughout development</p>
<p><strong>Code Generation Metrics:</strong>
- <strong>Lines of Code Generated:</strong> 60,008 (482 files)
- <strong>Automated Code Distribution:</strong>
  - JSON configurations: 21,155 lines
  - Python services: 11,915 lines
  - TypeScript/JavaScript: 7,172 lines
  - Infrastructure (YAML + HCL): 7,409 lines
  - Documentation: 8,910 lines</p>
<h3 id="92-infrastructure-metrics">9.2 Infrastructure Metrics</h3>
<p><strong>AWS Resources Provisioned (Staging Environment):</strong>
- <strong>Compute:</strong>
  - 1 EKS cluster (Kubernetes 1.28)
  - 6 EC2 instances (t3.large) across 3 availability zones
  - Auto-scaling group (min 2, max 10 nodes)
- <strong>Databases:</strong>
  - 1 RDS PostgreSQL 15 (db.r6g.xlarge, Multi-AZ)
  - 1 ElastiCache Redis 7 cluster (2 nodes, cross-AZ replication)
  - 1 MongoDB Atlas cluster (M10 tier, 3-node replica set)
- <strong>Storage:</strong>
  - 3 S3 buckets (documents, backups, CloudFront logs)
  - Total storage: 45 GB (documents: 30 GB, backups: 12 GB, logs: 3 GB)
- <strong>Networking:</strong>
  - 1 VPC (10.0.0.0/16)
  - 6 subnets (3 public, 3 private)
  - 2 NAT Gateways
  - 1 Application Load Balancer
  - 1 CloudFront distribution
- <strong>Message Queue:</strong>
  - 5 SQS queues (document-processing, calculation-requests, notifications, risk-updates, dead-letter)
  - 3 SNS topics (document-events, calculation-events, admin-alerts)</p>
<h3 id="93-performance-benchmarks">9.3 Performance Benchmarks</h3>
<p><strong>API Response Times (k6 Load Testing):</strong>
- <strong>Checklist Generation:</strong> 1.2s average (500 concurrent users)
- <strong>Product Emission Calculation:</strong> 42s average (100 suppliers), 18s (20 suppliers)
- <strong>Document Upload (Presigned URL):</strong> 0.3s
- <strong>Document Extraction (Async):</strong> 8-12s (OCR + LLM pipeline)
- <strong>Risk Score Retrieval:</strong> 0.8s (with Redis cache), 2.4s (cache miss)</p>
<p><strong>Database Query Performance:</strong>
- <strong>Emission Factor Lookup:</strong> 12ms (indexed query on region + sector + activity)
- <strong>Supplier List (Pagination):</strong> 35ms (1000 suppliers, cursor-based pagination)
- <strong>Audit Log Write:</strong> 8ms (append-only table, no indexes on write path)
- <strong>MongoDB Framework Query:</strong> 18ms (indexed on jurisdiction)</p>
<p><strong>AI Processing Performance:</strong>
- <strong>OCR (PyTesseract):</strong> 3-5s per scanned PDF page
- <strong>GPT-4 Extraction:</strong> 4-8s per document (latency depends on OpenAI API)
- <strong>Validation Engine:</strong> 0.5s (ruleset matching against 50 regulatory requirements)</p>
<h3 id="94-scalability-metrics">9.4 Scalability Metrics</h3>
<p><strong>Horizontal Pod Autoscaling (HPA) Configuration:</strong>
- <strong>Compliance Service:</strong> Min 2, Max 8 replicas (CPU threshold: 70%)
- <strong>Carbon Accounting Service:</strong> Min 2, Max 10 replicas (CPU threshold: 75%, high compute for calculations)
- <strong>Document Processing Service:</strong> Min 3, Max 12 replicas (Memory threshold: 80%, high memory for OCR/LLM)
- <strong>Risk Assessment Service:</strong> Min 2, Max 6 replicas
- <strong>Supply Chain Service:</strong> Min 2, Max 6 replicas
- <strong>Notification Service:</strong> Min 2, Max 5 replicas</p>
<p><strong>Concurrent User Testing:</strong>
- <strong>Test Scenario:</strong> 1000 concurrent users performing mixed operations (checklist retrieval, document uploads, calculations)
- <strong>Result:</strong> Average response time: 1.8s, 99th percentile: 5.2s, 0.02% error rate (all timeouts, no crashes)</p>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>The Sustaina ESG Compliance Platform represents a successful demonstration of <strong>AI-orchestrated software development</strong> at enterprise scale. CodeMachine's multi-agent architecture transformed a 187-page specification into a production-ready system with:</p>
<ul>
<li><strong>7 microservices</strong> handling complex regulatory logic, AI document processing, and carbon accounting</li>
<li><strong>Multi-database architecture</strong> (PostgreSQL, MongoDB, Redis, Elasticsearch) optimized for different data patterns</li>
<li><strong>Cloud-native infrastructure</strong> (AWS EKS, RDS, S3, CloudFront) with blue-green deployment</li>
<li><strong>Comprehensive testing</strong> (unit, integration, E2E) achieving 84% backend and 78% frontend coverage, with key calculation SLAs of 42s (against a 60s target)</li>
<li><strong>Full CI/CD automation</strong> (GitHub Actions, ArgoCD) enabling daily deployments to staging</li>
</ul>
<p><strong>Key Innovations:</strong>
1. <strong>Hierarchical Agent Orchestration:</strong> 48 specialized agents coordinated through bidirectional communication, reducing development time by an estimated 75% compared to manual implementation
2. <strong>Context-Aware Code Generation:</strong> Dynamic injection of architecture blueprints and existing code patterns ensured consistency and reduced hallucinations
3. <strong>Verification-Driven Quality:</strong> Automated validation loops (OpenAPI, SQL, TypeScript compilation) caught 87% of errors pre-review
4. <strong>Artifact-First Development:</strong> PlantUML diagrams and OpenAPI specs served as executable documentation, staying synchronized with code</p>
<p><strong>Impact for SMEs:</strong>
- <strong>Democratized Compliance:</strong> Complex CBAM, ESRS, ISO regulations distilled into clear checklists and traffic-light risk indicators
- <strong>Reduced Compliance Costs:</strong> Estimated 60% cost reduction vs manual consultants (€5,000/year vs €12,000-15,000)
- <strong>Faster Market Access:</strong> CBAM reports generated in minutes vs weeks of manual calculation
- <strong>Audit Readiness:</strong> AI-verified documentation provides defensible compliance evidence</p>
<p>CodeMachine has proven that <strong>specification-to-code orchestration</strong> can deliver enterprise-grade systems when:
- Specifications are detailed and structured (architecture blueprints, acceptance criteria)
- Agents are specialized by domain (database, backend, frontend, DevOps)
- Verification loops validate artifacts continuously
- Human oversight focuses on strategic decisions rather than boilerplate code</p>
<p>As Sustaina scales to serve thousands of SMEs across the MENA region, the CodeMachine-generated foundation provides a robust, maintainable, and extensible platform for continuous evolution of ESG compliance requirements.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.top", "navigation.tracking", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>